'use strict';







jest.
dontMock('AdsManagerCreativeUtils').
dontMock('URI').
dontMock('URIBase').
dontMock('URISchemes').
dontMock('ads-lib-urllib').
dontMock('isFacebookURI');






function mockAdsManagerImageUtils(isValidImageSource){
require('AdsManagerImageUtils').isValidImageSource.mockImplementation(
function(){return isValidImageSource;});}



describe('AdsManagerCreativeUtils',function(){

beforeEach(function(){
mockAdsManagerImageUtils(true);});


it('shows left character count correctly',function(){
var headlineMaxLength=require('AdsManagerCreativeUtils').MAX_HEADLINE_LENGTH;
var textMaxLength=require('AdsManagerCreativeUtils').MAX_TEXT_LENGTH;
var shortStr='0123';
var longStr='012345678901234567890123456789012345678901234567890123456789'+
'0123456789012345678901234567890123456789012345678901234567890123456789';
expect(require('AdsManagerCreativeUtils').getHeadlineCharacterLeft()).
toBe(headlineMaxLength);
expect(require('AdsManagerCreativeUtils').getHeadlineCharacterLeft('')).
toBe(headlineMaxLength);
expect(require('AdsManagerCreativeUtils').getHeadlineCharacterLeft(shortStr)).
toBe(headlineMaxLength-shortStr.length);
expect(require('AdsManagerCreativeUtils').getHeadlineCharacterLeft(longStr)).
toBe(headlineMaxLength-longStr.length);
expect(require('AdsManagerCreativeUtils').getTextCharacterLeft()).
toBe(textMaxLength);
expect(require('AdsManagerCreativeUtils').getTextCharacterLeft('')).
toBe(textMaxLength);
expect(require('AdsManagerCreativeUtils').getTextCharacterLeft(shortStr)).
toBe(textMaxLength-shortStr.length);
expect(require('AdsManagerCreativeUtils').getTextCharacterLeft(longStr)).
toBe(textMaxLength-longStr.length);});


it('gets errors correctly',function(){
var shortStr='test';
var longStr='0123456789012345678901234567890123456789012345678901234567890123456789'+
'0123456789012345678901234567890123456789012345678901234567890123456789';
var puncStreakStr='abcde!!';
var validPuncStreakStr='page("test")';
var puncStartStr='!abcde';
var badCharStr='abcde[test';
var badCharStr2='abcde\u0250test';

var url='http://www.testok.com';
var invalidURL='http://test';
var fbURL='http://www.facebook.com';
var invalidProtocolURL='ptth://test.com';

var image={};

var callNowCTA=require('AdsCallToActionTypes').TYPES.CALL_NOW.name;
var getDirectionsCTA=require('AdsCallToActionTypes').TYPES.GET_DIRECTIONS.name;
var validPhoneNumber='+17188516110';
var validAddress='1 hacker way menlo park';

var ctaData={
phoneNumber:validPhoneNumber,
address:validAddress};


var address={
geocode_address_data:{
edges:[
{
node:{
address:'1 Hacker Way',
city:'Menlo Park',
state_name:'California',
country_name:'United States',
postal_code:'94025-1455',
latitude:'37.4835205',
longitude:'-122.1501007'}}]}};






expect(require('AdsManagerCreativeUtils').getHeadlineEmptyError()).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineEmptyError(
require('AdsAPIObjectives').POST_ENGAGEMENT,
'')).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineEmptyError(
require('AdsAPIObjectives').PAGE_LIKES,
'')).
toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineEmptyError(
require('AdsAPIObjectives').POST_ENGAGEMENT,
shortStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineEmptyError(
require('AdsAPIObjectives').PAGE_LIKES,
shortStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineEmptyError(
require('AdsAPIObjectives').POST_ENGAGEMENT,
longStr)).
toBe(null);

expect(require('AdsManagerCreativeUtils').getTextEmptyError()).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getTextEmptyError('')).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getTextEmptyError(shortStr)).toBe(null);
expect(require('AdsManagerCreativeUtils').getTextEmptyError(longStr)).toBe(null);

expect(require('AdsManagerCreativeUtils').getHeadlineTooLongError()).toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineTooLongError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
'')).
toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineTooLongError(
require('AdsAPIObjectives').PAGE_LIKES,
'')).
toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineTooLongError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
shortStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineTooLongError(
require('AdsAPIObjectives').PAGE_LIKES,
shortStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineTooLongError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
longStr)).
not.toBe(null);

expect(require('AdsManagerCreativeUtils').getTextTooLongError()).toBe(null);
expect(require('AdsManagerCreativeUtils').getTextTooLongError('')).toBe(null);
expect(require('AdsManagerCreativeUtils').getTextTooLongError(shortStr)).toBe(null);
expect(require('AdsManagerCreativeUtils').getTextTooLongError(longStr)).not.toBe(null);

expect(require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
shortStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
longStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
puncStreakStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
puncStartStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
validPuncStreakStr)).
toBe(null);

expect(require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsAPIObjectives').PAGE_LIKES,
shortStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsAPIObjectives').PAGE_LIKES,
longStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsAPIObjectives').PAGE_LIKES,
puncStreakStr)).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsAPIObjectives').PAGE_LIKES,
puncStartStr)).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsAPIObjectives').PAGE_LIKES,
validPuncStreakStr)).
toBe(null);

expect(require('AdsManagerCreativeUtils').getTextBadCharError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
shortStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getTextBadCharError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
badCharStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getTextBadCharError(
require('AdsAPIObjectives').LOCAL_AWARENESS,
badCharStr2)).
toBe(null);

expect(require('AdsManagerCreativeUtils').getTextBadCharError(
require('AdsAPIObjectives').PAGE_LIKES,
shortStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getTextBadCharError(
require('AdsAPIObjectives').PAGE_LIKES,
badCharStr)).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getTextBadCharError(
require('AdsAPIObjectives').PAGE_LIKES,
badCharStr2)).
not.toBe(null);

expect(require('AdsManagerCreativeUtils').getHeadlineAndTextEmptyError()).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineAndTextEmptyError(
require('AdsAPIObjectives').POST_ENGAGEMENT,
'',
'')).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineAndTextEmptyError(
require('AdsAPIObjectives').PAGE_LIKES,
'',
'')).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineAndTextEmptyError(
require('AdsAPIObjectives').POST_ENGAGEMENT,
shortStr,
'')).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineAndTextEmptyError(
require('AdsAPIObjectives').POST_ENGAGEMENT,
'',
shortStr)).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineAndTextEmptyError(
require('AdsAPIObjectives').PAGE_LIKES,
'',
shortStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineAndTextEmptyError(
require('AdsAPIObjectives').POST_ENGAGEMENT,
shortStr,
shortStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineAndTextEmptyError(
require('AdsAPIObjectives').POST_ENGAGEMENT,
longStr,
longStr)).
toBe(null);
expect(require('AdsManagerCreativeUtils').getHeadlineAndTextEmptyError(
require('AdsAPIObjectives').PAGE_LIKES,
longStr,
longStr)).
toBe(null);

expect(require('AdsManagerCreativeUtils').getURLEmptyError()).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getURLEmptyError('')).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getURLEmptyError(url)).toBe(null);
expect(require('AdsManagerCreativeUtils').getURLEmptyError(invalidURL)).toBe(null);
expect(require('AdsManagerCreativeUtils').getURLEmptyError(fbURL)).toBe(null);
expect(require('AdsManagerCreativeUtils').getURLEmptyError(invalidProtocolURL)).toBe(null);

expect(require('AdsManagerCreativeUtils').getURLInvalidError(url)).toBe(null);
expect(require('AdsManagerCreativeUtils').getURLInvalidError(invalidURL)).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getURLInvalidError(fbURL)).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getURLInvalidError(invalidProtocolURL)).not.toBe(null);

expect(require('AdsManagerCreativeUtils').getURLError()).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getURLError('')).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getURLError(url)).toBe(null);
expect(require('AdsManagerCreativeUtils').getURLError(invalidURL)).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getURLError(fbURL)).not.toBe(null);
expect(require('AdsManagerCreativeUtils').getURLError(invalidProtocolURL)).not.toBe(null);


mockAdsManagerImageUtils(false);
expect(require('AdsManagerCreativeUtils').getAdImageError(
image,
require('AdsAPIObjectives').LOCAL_AWARENESS)).
not.toBe(null);


expect(require('AdsManagerCreativeUtils').getAdImageError(
image,
require('AdsAPIObjectives').POST_ENGAGEMENT)).
toBe(null);


mockAdsManagerImageUtils(true);
expect(require('AdsManagerCreativeUtils').getAdImageError(
image,
require('AdsAPIObjectives').LOCAL_AWARENESS)).
toBe(null);

expect(require('AdsManagerCreativeUtils').getTextAndLinkErrors(
require('AdsAPIObjectives').POST_ENGAGEMENT,
'',
'',
'').
length).toBe(1);
expect(require('AdsManagerCreativeUtils').getTextAndLinkErrors(
require('AdsAPIObjectives').LOCAL_AWARENESS,
'',
'',
'').
length).toBe(1);
expect(require('AdsManagerCreativeUtils').getCreativeErrors(
require('AdsAPIObjectives').LOCAL_AWARENESS,
shortStr,
shortStr,
url,
image,
callNowCTA,
ctaData).
length).toBe(0);
expect(require('AdsManagerCreativeUtils').getCreativeErrors(
require('AdsAPIObjectives').LOCAL_AWARENESS,
shortStr,
shortStr,
url,
image,
callNowCTA).
length).toBe(1);
expect(require('AdsManagerCreativeUtils').getTextAndLinkErrors(
require('AdsAPIObjectives').WEBSITE_CLICKS,
'',
'',
'').
length).toBe(2);

expect(require('AdsManagerCreativeUtils').getTextAndLinkErrors(
require('AdsAPIObjectives').WEBSITE_CLICKS,
shortStr,
shortStr,
url).
length).toBe(0);
expect(require('AdsManagerCreativeUtils').getTextAndLinkErrors(
require('AdsAPIObjectives').WEBSITE_CLICKS,
longStr,
longStr,
fbURL).
length).toBe(3);


mockAdsManagerImageUtils(true);
expect(require('AdsManagerCreativeUtils').getCreativeErrors(
require('AdsAPIObjectives').WEBSITE_CLICKS,
shortStr,
shortStr,
url,
image).
length).toBe(0);

mockAdsManagerImageUtils(false);
expect(require('AdsManagerCreativeUtils').getCreativeErrors(
require('AdsAPIObjectives').WEBSITE_CLICKS,
'',
'',
'',
image).
length).toBe(3);

expect(require('AdsManagerCreativeUtils').getPhoneNumberError(validPhoneNumber)).toBe(null);
expect(require('AdsManagerCreativeUtils').getPhoneNumberError()).not.toBe(null);

expect(require('AdsManagerCreativeUtils').getAddressError(validAddress)).toBe(null);
expect(require('AdsManagerCreativeUtils').getAddressError()).not.toBe(null);

expect(require('AdsManagerCreativeUtils').getCTAError()).toBe(null);
expect(require('AdsManagerCreativeUtils').getCTAError(callNowCTA,ctaData)).toBe(null);
expect(require('AdsManagerCreativeUtils').getCTAError(callNowCTA,null)).not.toBe(null);

expect(require('AdsManagerCreativeUtils').getCTAError(getDirectionsCTA,ctaData)).toBe(null);
expect(require('AdsManagerCreativeUtils').getCTAError(getDirectionsCTA,null)).not.toBe(null);

expect(require('AdsManagerCreativeUtils').getLocationURLFromAddress(null)).toBe(null);
expect(require('AdsManagerCreativeUtils').getLocationURLFromAddress(address)).not.toBe(null);});


it('should get is image required correctly',function(){
expect(require('AdsManagerCreativeUtils').isImageRequiredForObjective(
require('AdsAPIObjectives').POST_ENGAGEMENT)).
toBe(false);
expect(require('AdsManagerCreativeUtils').isImageRequiredForObjective(
require('AdsAPIObjectives').LOCAL_AWARENESS)).
toBe(true);
expect(require('AdsManagerCreativeUtils').isImageRequiredForObjective(
require('AdsAPIObjectives').WEBSITE_CLICKS)).
toBe(true);
expect(require('AdsManagerCreativeUtils').isImageRequiredForObjective(
require('AdsAPIObjectives').PAGE_LIKES)).
toBe(true);});


it('should get image crop sizes',function(){
expect(require('AdsManagerCreativeUtils').getImageCropSizeForObjective(
require('AdsAPIObjectives').PAGE_LIKES)).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getImageCropSizeForObjective(
require('AdsAPIObjectives').LOCAL_AWARENESS)).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getMinimumImageCropSizeForObjective(
require('AdsAPIObjectives').PAGE_LIKES)).
not.toBe(null);
expect(require('AdsManagerCreativeUtils').getMinimumImageCropSizeForObjective(
require('AdsAPIObjectives').LOCAL_AWARENESS)).
not.toBe(null);});


it('should update image hash correctly',function(){
var mockImageHash='image_hash';
var mockCreativeSpec1={
object_story_spec:{
link_data:{}}};



var spec=require('AdsManagerCreativeUtils').updateCreativeSpecWithImageHash(
mockCreativeSpec1,
mockImageHash);


expect(spec).toBe(mockCreativeSpec1);
expect(mockCreativeSpec1.object_story_spec.link_data.image_hash).toEqual(mockImageHash);

var mockCreativeSpec2={};
var spec2=require('AdsManagerCreativeUtils').updateCreativeSpecWithImageHash(
mockCreativeSpec2,
mockImageHash);

expect(spec2).toBe(mockCreativeSpec2);
expect(mockCreativeSpec2.image_hash).toEqual(mockImageHash);});});