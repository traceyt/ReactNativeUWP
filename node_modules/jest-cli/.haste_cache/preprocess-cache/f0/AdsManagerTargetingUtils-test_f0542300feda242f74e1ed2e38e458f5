'use strict';







jest.dontMock('AdsManagerTargetingUtils').
dontMock('AdsManagerGender');;









var LOCATION_COUNTRY_GB={
country_code:'GB',
key:'GB',
location_type:'COUNTRY',
name:'United Kingdom',
alcohol_min_age:18};


var LOCATION_REGION={
country_code:'US',
key:'3886',
location_type:'REGION',
name:'Texas',
alcohol_min_age:21};


var LOCATION_CITY_CA={
country_code:'CA',
key:'296995',
location_type:'CITY',
name:'Vancouver, British Columbia',
alcohol_min_age:19};


var LOCATION_ZIP={
country_code:'US',
key:'US: 94043',
location_type:'ZIP',
name:'94043',
alcohol_min_age:21};


var LOCATION_CUSTOM={
country_code:'CA',
key:'296995',
location_type:'CUSTOM_LOCATION',
name:'1 hacker way, Menlo Park, CA',
address:'1 hacker way, Menlo Park, CA',
alcohol_min_age:21};


var AUDIENCE_FAN={
name:'',
audienceID:-2,
ageMax:65,
ageMin:13,
gender:'FEMALE',
locations:[
LOCATION_COUNTRY_GB],

interests:[],
type:require('AdsManagerAudienceType').INLINE_AUDIENCE};


var AUDIENCE_FAN_AND_FRIENDS={
name:'',
audienceID:-6,
ageMax:65,
ageMin:13,
gender:null,
locations:[
LOCATION_COUNTRY_GB,
LOCATION_REGION,
LOCATION_ZIP],

interests:[],
type:require('AdsManagerAudienceType').INLINE_AUDIENCE};


var AUDIENCE_INLINE_CAMPAIGN_AUDIENCE={
name:'inline',
audienceID:-5,
ageMax:65,
ageMin:13,
gender:null,
locations:[
LOCATION_COUNTRY_GB],

type:require('AdsManagerAudienceType').INLINE_AUDIENCE};


var AUDIENCE_WITHOUT_INTERESTS={
audienceID:123456,
ageMax:45,
ageMin:13,
gender:null,
locations:[
LOCATION_REGION,
LOCATION_ZIP],

type:require('AdsManagerAudienceType').SAVE_AUDIENCE};


var AUDIENCE_WITHOUT_LOCATION={
name:'name',
audienceID:123456,
ageMax:45,
ageMin:13,
gender:null,
locations:[],
needsLocations:true,
type:require('AdsManagerAudienceType').SAVE_AUDIENCE};


var AUDIENCE_NO_NEED_LOCATION={
name:'name',
audienceID:123456,
ageMax:45,
ageMin:13,
gender:null,
locations:[],
needsLocations:false,
type:require('AdsManagerAudienceType').SAVE_AUDIENCE};


var AUDIENCE_WITH_TOO_MANY_COUNTRIES={
name:'name',
audienceID:123456,
ageMax:45,
ageMin:13,
gender:null,
locations:[
{country_code:'GB'},{country_code:'CA'},{country_code:'CN'},
{country_code:'US'},{country_code:'VN'},{country_code:'FR'},
{country_code:'TW'},{country_code:'HK'},{country_code:'BR'},
{country_code:'TH'},{country_code:'KR'},{country_code:'AU'},
{country_code:'TJ'},{country_code:'TZ'},{country_code:'TL'},
{country_code:'TN'},{country_code:'TV'},{country_code:'KZ'},
{country_code:'RU'},{country_code:'RW'},{country_code:'JM'},
{country_code:'KR'},{country_code:'CY'},{country_code:'KH'},
{country_code:'KG'},{country_code:'DK'},{country_code:'ET'}],

type:require('AdsManagerAudienceType').SAVE_AUDIENCE};


var AUDIENCE_CUSTOM={
name:'name',
audienceID:123456,
needsLocations:false,
type:require('AdsManagerAudienceType').CUSTOM_AUDIENCE};


var AUDIENCE_LOOKALIKE={
name:'name',
audienceID:123456,
needsLocations:false,
type:require('AdsManagerAudienceType').LOOKALIKE_AUDIENCE};


var AUDIENCE_WITHOUT_NAME={
name:'',
audienceID:123456,
ageMax:45,
ageMin:13,
gender:null,
locations:[
LOCATION_REGION,
LOCATION_ZIP],

type:require('AdsManagerAudienceType').SAVE_AUDIENCE};


var AUDIENCE_WITH_INTERESTS=babelHelpers.extends({},
AUDIENCE_WITHOUT_INTERESTS,{
interests:[
{
name:'Music'},

{
name:'Dance'}]});




var AUDIENCE_LOCAL_AWARENESS={
name:'',
audienceID:-4,
ageMax:45,
ageMin:13,
gender:null,
locations:[
LOCATION_CUSTOM],

type:require('AdsManagerAudienceType').INLINE_AUDIENCE};


var LOCATIONS=[
LOCATION_ZIP,
LOCATION_COUNTRY_GB,
LOCATION_CITY_CA];


var PAGE={
whitelisted_countries:[
'CA'],

blacklisted_countries:[
'GB'],

has_alcohol_content:false};


var PAGE_WITH_ALCOHOL_CONTENT={
whitelisted_countries:[
'CA'],

blacklisted_countries:[
'GB'],

has_alcohol_content:true};


var PAGE_WITH_MIN_AGE_RESTRICTION={
default_ad_target_spec:{
min_age:18}};





describe('AdsManagerTargetingUtils',function(){

it('detect blacklisted locations correctly',function(){
expect(require('AdsManagerTargetingUtils').isBlacklistedCountry()).toBe(false);
expect(require('AdsManagerTargetingUtils').isBlacklistedCountry('CA')).toBe(false);
expect(require('AdsManagerTargetingUtils').isBlacklistedCountry(
'CA',
PAGE)).
toBe(false);
expect(require('AdsManagerTargetingUtils').isBlacklistedCountry(
'US',
PAGE)).
toBe(true);
expect(require('AdsManagerTargetingUtils').isBlacklistedCountry(
'GB',
PAGE)).
toBe(true);

expect(require('AdsManagerTargetingUtils').getBlacklistedLocations().length).toBe(0);
expect(require('AdsManagerTargetingUtils').getBlacklistedLocations(
LOCATIONS).
length).toBe(0);
expect(require('AdsManagerTargetingUtils').getBlacklistedLocations(
LOCATIONS,
PAGE).
length).toBe(2);

expect(require('AdsManagerTargetingUtils').getBlacklistedLocationsError()).toBe(null);
expect(require('AdsManagerTargetingUtils').getBlacklistedLocationsError(
LOCATIONS)).
toBe(null);
expect(require('AdsManagerTargetingUtils').getBlacklistedLocationsError(
LOCATIONS,
PAGE)).
not.toBe(null);});


it('get targeting sentences correctly',function(){
expect(
require('AdsManagerTargetingUtils').getTargetingSentences().length).
toBe(0);
expect(
require('AdsManagerTargetingUtils').getTargetingSentences(
AUDIENCE_FAN).
length).
toBe(2);
expect(
require('AdsManagerTargetingUtils').getTargetingSentences(
AUDIENCE_FAN_AND_FRIENDS).
length).
toBe(2);
expect(
require('AdsManagerTargetingUtils').getTargetingSentences(
AUDIENCE_WITHOUT_INTERESTS).
length).
toBe(2);
expect(
require('AdsManagerTargetingUtils').getTargetingSentences(
AUDIENCE_WITH_INTERESTS).
length).
toBe(3);});


it('detect min age conflicts with alcohol restriction correctly',function(){
expect(
require('AdsManagerTargetingUtils').getMinAgeConflictingWithAlcoholRestrictionError(
13)).

toBe(null);
expect(
require('AdsManagerTargetingUtils').getMinAgeConflictingWithAlcoholRestrictionError(
18)).

toBe(null);
expect(
require('AdsManagerTargetingUtils').getMinAgeConflictingWithAlcoholRestrictionError(
22,
LOCATIONS,
PAGE_WITH_ALCOHOL_CONTENT)).

toBe(null);
expect(
require('AdsManagerTargetingUtils').getMinAgeConflictingWithAlcoholRestrictionError(
18,
LOCATIONS,
PAGE_WITH_ALCOHOL_CONTENT)).

not.toBe(null);
expect(
require('AdsManagerTargetingUtils').getMinAgeConflictingWithAlcoholRestrictionError(
18,
LOCATIONS,
PAGE)).

toBe(null);
expect(
require('AdsManagerTargetingUtils').getAlcohoMinAgeForPageWithLocations(
LOCATIONS,
PAGE_WITH_ALCOHOL_CONTENT)).

toBe(21);
expect(
require('AdsManagerTargetingUtils').getAlcohoMinAgeForPageWithLocations(
LOCATIONS,
PAGE)).

toBe(0);
expect(require('AdsManagerTargetingUtils').getAlcoholMinAgeForLocations()).toBe(0);
expect(require('AdsManagerTargetingUtils').getAlcoholMinAgeForLocations(
LOCATIONS)).
toBe(21);});


it('test audience name should hide correctly',function(){
expect(require('AdsManagerTargetingUtils').audienceNameShouldHide()).toBe(false);
expect(require('AdsManagerTargetingUtils').audienceNameShouldHide(
AUDIENCE_INLINE_CAMPAIGN_AUDIENCE)).
toBe(true);
expect(require('AdsManagerTargetingUtils').audienceNameShouldHide(
AUDIENCE_FAN)).
toBe(false);});


it('get audience name error correctly',function(){
expect(require('AdsManagerTargetingUtils').getAudienceNameError()).toBe(null);
expect(require('AdsManagerTargetingUtils').getAudienceNameError(
AUDIENCE_WITHOUT_NAME)).
not.toBe(null);
expect(require('AdsManagerTargetingUtils').getAudienceNameError(
AUDIENCE_FAN)).
toBe(null);});


it('get audience country limit error correctly',function(){
expect(require('AdsManagerTargetingUtils').getCountriesLimitError()).toBe(null);
expect(require('AdsManagerTargetingUtils').getCountriesLimitError(
AUDIENCE_WITH_TOO_MANY_COUNTRIES)).
not.toBe(null);
expect(require('AdsManagerTargetingUtils').getCountriesLimitError(
AUDIENCE_FAN)).
toBe(null);});


it('get audience empty location error correctly',function(){
expect(require('AdsManagerTargetingUtils').getEmptyLocationsError()).not.toBe(null);
expect(require('AdsManagerTargetingUtils').getEmptyLocationsError(
AUDIENCE_WITHOUT_LOCATION.locations)).
not.toBe(null);
expect(require('AdsManagerTargetingUtils').getEmptyLocationsError(
AUDIENCE_FAN.locations)).
toBe(null);
expect(require('AdsManagerTargetingUtils').getEmptyLocationsErrorForReviewScreen()).
toBeNull();
expect(require('AdsManagerTargetingUtils').getEmptyLocationsErrorForReviewScreen()).
toBeNull();
expect(require('AdsManagerTargetingUtils').getEmptyLocationsErrorForReviewScreen(
AUDIENCE_NO_NEED_LOCATION)).
toBeNull();
expect(require('AdsManagerTargetingUtils').getEmptyLocationsErrorForReviewScreen(
AUDIENCE_CUSTOM)).
toBeNull();
expect(require('AdsManagerTargetingUtils').getEmptyLocationsErrorForReviewScreen(
AUDIENCE_WITHOUT_LOCATION)).
not.toBe(null);});


it('get audience errors correctly',function(){
expect(
require('AdsManagerTargetingUtils').getAudienceErrors().length).
toBe(0);
expect(
require('AdsManagerTargetingUtils').getAudienceErrors(
AUDIENCE_NO_NEED_LOCATION).
length).
toBe(0);
expect(
require('AdsManagerTargetingUtils').getAudienceErrors(
AUDIENCE_WITHOUT_LOCATION).
length).
toBe(1);
expect(
require('AdsManagerTargetingUtils').getAudienceErrors(
AUDIENCE_WITH_TOO_MANY_COUNTRIES).
length).
toBe(1);
expect(
require('AdsManagerTargetingUtils').getAudienceErrors(
AUDIENCE_WITHOUT_NAME).
length).
toBe(0);
expect(
require('AdsManagerTargetingUtils').getAudienceErrors(
AUDIENCE_INLINE_CAMPAIGN_AUDIENCE).
length).
toBe(0);});


it('get min age restrction from page setting error correctly',function(){
expect(require('AdsManagerTargetingUtils').getAgeRestrictionFromPageSettingError()).
toBe(null);
expect(require('AdsManagerTargetingUtils').getAgeRestrictionFromPageSettingError(
AUDIENCE_FAN,
0)).
toBe(null);
expect(require('AdsManagerTargetingUtils').getAgeRestrictionFromPageSettingError(
AUDIENCE_FAN,
13)).
toBe(null);
expect(require('AdsManagerTargetingUtils').getAgeRestrictionFromPageSettingError(
AUDIENCE_FAN,
18)).
not.toBe(null);});


it('get min age restrction from call now cta error correctly',function(){
expect(require('AdsManagerTargetingUtils').getAgeRestrictionFromCallNowCTAError()).
toBe(null);
expect(require('AdsManagerTargetingUtils').getAgeRestrictionFromCallNowCTAError(
AUDIENCE_LOOKALIKE,
18)).
toBe(null);
expect(require('AdsManagerTargetingUtils').getAgeRestrictionFromCallNowCTAError(
AUDIENCE_FAN,
13)).
toBe(null);
expect(require('AdsManagerTargetingUtils').getAgeRestrictionFromCallNowCTAError(
AUDIENCE_FAN,
18)).
not.toBe(null);});


it('test audience is custom audience correctly',function(){
expect(require('AdsManagerTargetingUtils').isCustomAudience()).toBe(false);
expect(require('AdsManagerTargetingUtils').isCustomAudience(
AUDIENCE_LOOKALIKE)).
toBe(true);
expect(require('AdsManagerTargetingUtils').isCustomAudience(
AUDIENCE_CUSTOM)).
toBe(true);
expect(require('AdsManagerTargetingUtils').isCustomAudience(
AUDIENCE_FAN)).
toBe(false);});


it('get min age from page correctly',function(){
expect(require('AdsManagerTargetingUtils').getMinAgeFromPage()).toBe(13);
expect(require('AdsManagerTargetingUtils').getMinAgeFromPage(
PAGE)).
toBe(13);
expect(require('AdsManagerTargetingUtils').getMinAgeFromPage(
PAGE_WITH_MIN_AGE_RESTRICTION)).
toBe(18);});


it('get selecting audience errors correctly',function(){
expect(require('AdsManagerTargetingUtils').getSelectAudienceErrors().length).toBe(0);

expect(require('AdsManagerTargetingUtils').getSelectAudienceErrors(
AUDIENCE_CUSTOM,
PAGE).
length).toBe(0);

expect(require('AdsManagerTargetingUtils').getSelectAudienceErrors(
AUDIENCE_FAN_AND_FRIENDS,
PAGE).
length).toBe(1);

expect(require('AdsManagerTargetingUtils').getSelectAudienceErrors(
AUDIENCE_FAN,
PAGE_WITH_MIN_AGE_RESTRICTION).
length).toBe(1);

expect(require('AdsManagerTargetingUtils').getSelectAudienceErrors(
AUDIENCE_FAN,
PAGE_WITH_ALCOHOL_CONTENT).
length).toBe(2);});


it('get targeting errors correctly',function(){
expect(require('AdsManagerTargetingUtils').getTargetingErrors().length).toBe(0);

expect(require('AdsManagerTargetingUtils').getTargetingErrors(
AUDIENCE_CUSTOM,
PAGE).
length).toBe(0);


expect(require('AdsManagerTargetingUtils').getTargetingErrors(
AUDIENCE_NO_NEED_LOCATION,
null).
length).toBe(0);
expect(require('AdsManagerTargetingUtils').getTargetingErrors(
AUDIENCE_WITHOUT_LOCATION,
null).
length).toBe(1);
expect(require('AdsManagerTargetingUtils').getTargetingErrors(
AUDIENCE_WITH_TOO_MANY_COUNTRIES,
null).
length).toBe(1);
expect(require('AdsManagerTargetingUtils').getTargetingErrors(
AUDIENCE_WITHOUT_NAME,
null).
length).toBe(1);
expect(require('AdsManagerTargetingUtils').getTargetingErrors(
AUDIENCE_INLINE_CAMPAIGN_AUDIENCE,
null).
length).toBe(0);


expect(require('AdsManagerTargetingUtils').getTargetingErrors(
AUDIENCE_FAN_AND_FRIENDS,
PAGE).
length).toBe(1);
expect(require('AdsManagerTargetingUtils').getTargetingErrors(
AUDIENCE_FAN,
PAGE_WITH_MIN_AGE_RESTRICTION).
length).toBe(1);
expect(require('AdsManagerTargetingUtils').getTargetingErrors(
AUDIENCE_FAN,
PAGE_WITH_ALCOHOL_CONTENT).
length).toBe(2);});


it('get targeting error for review screen correctly',function(){
expect(require('AdsManagerTargetingUtils').getTargetingErrorsForReviewScreen().
length).toBe(0);

expect(require('AdsManagerTargetingUtils').getTargetingErrorsForReviewScreen(
AUDIENCE_NO_NEED_LOCATION,
13).
length).toBe(0);
expect(require('AdsManagerTargetingUtils').getTargetingErrorsForReviewScreen(
AUDIENCE_CUSTOM,
13).
length).toBe(0);
expect(require('AdsManagerTargetingUtils').getTargetingErrorsForReviewScreen(
AUDIENCE_WITHOUT_LOCATION,
13).
length).toBe(1);


expect(require('AdsManagerTargetingUtils').getTargetingErrorsForReviewScreen(
AUDIENCE_FAN,
18).
length).toBe(1);});


it('get auto generated audience name correctly',function(){
require('AdsManagerLocations').humanReadableLocationsSnippet.mockImplementation(
function(locations){
var results=locations.map(function(location){return location.name;});
return require('intlList')(results,require('intlList').CONJUNCTIONS.NONE);});


require('AdsManagerGender').humanReadableSymbol=jest.genMockFn().mockImplementation(
function(gender){
if(!gender){
return 'All';}

return gender;});


require('AdsManagerAges').humanReadableRange=jest.genMockFn().mockImplementation(
function(ageMin,ageMax){
return ageMin+'-'+ageMax;});



var fbt=require('fbt');
fbt.replaceParams=true;
fbt.jsonEncode=false;
expect(require('AdsManagerTargetingUtils').generateNameFromAudience()).toBeNull();
expect(require('AdsManagerTargetingUtils').generateNameFromAudience(
AUDIENCE_CUSTOM)).
toBeNull();
expect(require('AdsManagerTargetingUtils').generateNameFromAudience(
AUDIENCE_WITHOUT_LOCATION)).
toBe(' - All - 13-45');
expect(require('AdsManagerTargetingUtils').generateNameFromAudience(
AUDIENCE_FAN)).
toBe('United Kingdom - FEMALE - 13-65');
expect(require('AdsManagerTargetingUtils').generateNameFromAudience(
AUDIENCE_FAN_AND_FRIENDS)).
toBe('United Kingdom,Texas,94043 - All - 13-65');
expect(require('AdsManagerTargetingUtils').generateNameFromAudience(
AUDIENCE_INLINE_CAMPAIGN_AUDIENCE)).
toBe('United Kingdom - All - 13-65');
expect(require('AdsManagerTargetingUtils').generateNameFromAudience(
AUDIENCE_WITH_INTERESTS)).
toBe('Texas,94043 - All - 13-45');
expect(require('AdsManagerTargetingUtils').generateNameFromAudience(
AUDIENCE_LOCAL_AWARENESS)).
toBe('All - 13-45 - 1 hacker way, Menlo Park, CA');});});