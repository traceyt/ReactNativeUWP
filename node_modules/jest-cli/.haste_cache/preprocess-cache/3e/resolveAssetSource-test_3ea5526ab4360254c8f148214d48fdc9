'use strict';









jest.
dontMock('AssetRegistry').
dontMock('../resolveAssetSource').
dontMock('../../../local-cli/bundle/assetPathUtils');






function expectResolvesAsset(input,expectedSource){
var assetId=require('AssetRegistry').registerAsset(input);
expect(require('../resolveAssetSource')(assetId)).toEqual(expectedSource);}


describe('resolveAssetSource',function(){
beforeEach(function(){
jest.resetModuleRegistry();});


it('returns same source for simple static and network images',function(){
var source1={uri:'https://www.facebook.com/logo'};
expect(require('../resolveAssetSource')(source1)).toBe(source1);

var source2={uri:'logo'};
expect(require('../resolveAssetSource')(source2)).toBe(source2);});


it('does not change deprecated assets',function(){
expect(require('../resolveAssetSource')({
deprecated:true,
width:100,
height:200,
uri:'logo'})).
toEqual({
deprecated:true,
width:100,
height:200,
uri:'logo'});});



it('ignores any weird data',function(){
expect(require('../resolveAssetSource')(null)).toBe(null);
expect(require('../resolveAssetSource')(42)).toBe(null);
expect(require('../resolveAssetSource')('nonsense')).toBe(null);});


describe('bundle was loaded from network (DEV)',function(){
beforeEach(function(){
require('NativeModules').SourceCode.scriptURL=
'http://10.0.0.1:8081/main.bundle';
require('Platform').OS='ios';});


it('uses network image',function(){
expectResolvesAsset({
__packager_asset:true,
fileSystemLocation:'/root/app/module/a',
httpServerLocation:'/assets/module/a',
width:100,
height:200,
scales:[1],
hash:'5b6f00f',
name:'logo',
type:'png'},
{
__packager_asset:true,
width:100,
height:200,
uri:'http://10.0.0.1:8081/assets/module/a/logo.png?platform=ios&hash=5b6f00f',
scale:1});});



it('picks matching scale',function(){
expectResolvesAsset({
__packager_asset:true,
fileSystemLocation:'/root/app/module/a',
httpServerLocation:'/assets/module/a',
width:100,
height:200,
scales:[1,2,3],
hash:'5b6f00f',
name:'logo',
type:'png'},
{
__packager_asset:true,
width:100,
height:200,
uri:'http://10.0.0.1:8081/assets/module/a/logo@2x.png?platform=ios&hash=5b6f00f',
scale:2});});});





describe('bundle was loaded from file on iOS',function(){
beforeEach(function(){
require('NativeModules').SourceCode.scriptURL=
'file:///Path/To/Sample.app/main.bundle';
require('Platform').OS='ios';});


it('uses pre-packed image',function(){
expectResolvesAsset({
__packager_asset:true,
fileSystemLocation:'/root/app/module/a',
httpServerLocation:'/assets/module/a',
width:100,
height:200,
scales:[1],
hash:'5b6f00f',
name:'logo',
type:'png'},
{
__packager_asset:true,
width:100,
height:200,
uri:'/Path/To/Sample.app/assets/module/a/logo.png',
scale:1});});});




describe('bundle was loaded from assets on Android',function(){
beforeEach(function(){
require('NativeModules').SourceCode.scriptURL=
'assets://Path/To/Simulator/main.bundle';
require('Platform').OS='android';});


it('uses pre-packed image',function(){
expectResolvesAsset({
__packager_asset:true,
fileSystemLocation:'/root/app/module/a',
httpServerLocation:'/assets/AwesomeModule/Subdir',
width:100,
height:200,
scales:[1],
hash:'5b6f00f',
name:'!@Logo#1_€',
type:'png'},
{
__packager_asset:true,
width:100,
height:200,
uri:'awesomemodule_subdir_logo1_',
scale:1});});});




describe('bundle was loaded from file on Android',function(){
beforeEach(function(){
require('NativeModules').SourceCode.scriptURL=
'file:///sdcard/Path/To/Simulator/main.bundle';
require('Platform').OS='android';});


it('uses pre-packed image',function(){
expectResolvesAsset({
__packager_asset:true,
fileSystemLocation:'/root/app/module/a',
httpServerLocation:'/assets/AwesomeModule/Subdir',
width:100,
height:200,
scales:[1],
hash:'5b6f00f',
name:'!@Logo#1_€',
type:'png'},
{
__packager_asset:true,
width:100,
height:200,
uri:'file:///sdcard/Path/To/Simulator/drawable-mdpi/awesomemodule_subdir_logo1_.png',
scale:1});});});




describe('bundle was loaded from raw file on Android',function(){
beforeEach(function(){
require('NativeModules').SourceCode.scriptURL=
'/sdcard/Path/To/Simulator/main.bundle';
require('Platform').OS='android';});


it('uses sideloaded image',function(){
expectResolvesAsset({
__packager_asset:true,
fileSystemLocation:'/root/app/module/a',
httpServerLocation:'/assets/AwesomeModule/Subdir',
width:100,
height:200,
scales:[1],
hash:'5b6f00f',
name:'!@Logo#1_€',
type:'png'},
{
__packager_asset:true,
width:100,
height:200,
uri:'file:///sdcard/Path/To/Simulator/drawable-mdpi/awesomemodule_subdir_logo1_.png',
scale:1});});});});






describe('resolveAssetSource.pickScale',function(){
it('picks matching scale',function(){
expect(require('../resolveAssetSource').pickScale([1],2)).toBe(1);
expect(require('../resolveAssetSource').pickScale([1,2,3],2)).toBe(2);
expect(require('../resolveAssetSource').pickScale([1,2],3)).toBe(2);
expect(require('../resolveAssetSource').pickScale([1,2,3,4],3.5)).toBe(4);
expect(require('../resolveAssetSource').pickScale([3,4],2)).toBe(3);
expect(require('../resolveAssetSource').pickScale([],2)).toBe(1);});});