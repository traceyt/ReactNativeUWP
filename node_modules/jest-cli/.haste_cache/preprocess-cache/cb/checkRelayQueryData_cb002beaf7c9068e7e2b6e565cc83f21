'use strict';var _RelayConnectionInter=require('RelayConnectionInterface');var 
































EDGES=_RelayConnectionInter.EDGES;var PAGE_INFO=_RelayConnectionInter.PAGE_INFO;







function checkRelayQueryData(
store,
query)
{

var checker=new RelayQueryChecker(store);

var state={
dataID:undefined,
rangeInfo:undefined,
result:true};


checker.visit(query,state);
return state.result;}var 


RelayQueryChecker=function(_RelayQueryVisitor){babelHelpers.inherits(RelayQueryChecker,_RelayQueryVisitor);


function RelayQueryChecker(store){babelHelpers.classCallCheck(this,RelayQueryChecker);var _this=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(RelayQueryChecker).call(this));

_this.$RelayQueryChecker_store=store;return _this;}babelHelpers.createClass(RelayQueryChecker,[{key:'traverse',value:function traverse(






node,
state)
{
var children=node.getChildren();
for(var ii=0;ii<children.length;ii++){
if(!state.result){
return;}

this.visit(children[ii],state);}}},{key:'visitRoot',value:function visitRoot(




root,
state)
{var _this2=this;
var storageKey=root.getStorageKey();
require('forEachRootCallArg')(root,function(_ref){var identifyingArgKey=_ref.identifyingArgKey;
var dataID=_this2.$RelayQueryChecker_store.getDataID(storageKey,identifyingArgKey);
if(dataID==null){
state.result=false;}else 
{
var nextState={
dataID:dataID,
rangeInfo:undefined,
result:true};

_this2.traverse(root,nextState);
state.result=state.result&&nextState.result;}});}},{key:'visitFragment',value:function visitFragment(





fragment,
state)
{
var dataID=state.dataID;

if(dataID&&require('isCompatibleRelayFragmentType')(
fragment,
this.$RelayQueryChecker_store.getType(dataID)))
{
this.traverse(fragment,state);}}},{key:'visitField',value:function visitField(




field,
state)
{
var dataID=state.dataID;
var recordState=dataID&&this.$RelayQueryChecker_store.getRecordState(dataID);
if(recordState===require('RelayRecordState').UNKNOWN){
state.result=false;
return;}else 
if(recordState===require('RelayRecordState').NONEXISTENT){
return;}

var rangeInfo=state.rangeInfo;
if(rangeInfo&&field.getSchemaName()===EDGES){
this.$RelayQueryChecker_checkEdges(field,state);}else 
if(rangeInfo&&field.getSchemaName()===PAGE_INFO){
this.$RelayQueryChecker_checkPageInfo(field,state);}else 
if(!field.canHaveSubselections()){
this.$RelayQueryChecker_checkScalar(field,state);}else 
if(field.isPlural()){
this.$RelayQueryChecker_checkPlural(field,state);}else 
if(field.isConnection()){
this.$RelayQueryChecker_checkConnection(field,state);}else 
{
this.$RelayQueryChecker_checkLinkedField(field,state);}}},{key:'$RelayQueryChecker_checkScalar',value:function $RelayQueryChecker_checkScalar(



field,state){
var fieldData=state.dataID&&
this.$RelayQueryChecker_store.getField(state.dataID,field.getStorageKey());
if(fieldData===undefined){
state.result=false;}}},{key:'$RelayQueryChecker_checkPlural',value:function $RelayQueryChecker_checkPlural(



field,state){
var dataIDs=state.dataID&&
this.$RelayQueryChecker_store.getLinkedRecordIDs(state.dataID,field.getStorageKey());
if(dataIDs===undefined){
state.result=false;
return;}

if(dataIDs){
for(var ii=0;ii<dataIDs.length;ii++){
if(!state.result){
break;}

var nextState={
dataID:dataIDs[ii],
rangeInfo:undefined,
result:true};

this.traverse(field,nextState);
state.result=nextState.result;}}}},{key:'$RelayQueryChecker_checkConnection',value:function $RelayQueryChecker_checkConnection(




field,state){
var calls=field.getCallsWithValues();
var dataID=state.dataID&&
this.$RelayQueryChecker_store.getLinkedRecordID(state.dataID,field.getStorageKey());
if(dataID===undefined){
state.result=false;
return;}

var nextState={
dataID:dataID,
rangeInfo:null,
result:true};

var metadata=this.$RelayQueryChecker_store.getRangeMetadata(dataID,calls);
if(metadata){
nextState.rangeInfo=metadata;}

this.traverse(field,nextState);
state.result=state.result&&nextState.result;}},{key:'$RelayQueryChecker_checkEdges',value:function $RelayQueryChecker_checkEdges(


field,state){
var rangeInfo=state.rangeInfo;
if(!rangeInfo){
state.result=false;
return;}

if(rangeInfo.diffCalls.length){
state.result=false;
return;}

var edges=rangeInfo.filteredEdges;
for(var ii=0;ii<edges.length;ii++){
if(!state.result){
break;}

var nextState={
dataID:edges[ii].edgeID,
rangeInfo:undefined,
result:true};

this.traverse(field,nextState);
state.result=nextState.result;}}},{key:'$RelayQueryChecker_checkPageInfo',value:function $RelayQueryChecker_checkPageInfo(



field,state){
var rangeInfo=state.rangeInfo;
if(!rangeInfo||!rangeInfo.pageInfo){
state.result=false;
return;}}},{key:'$RelayQueryChecker_checkLinkedField',value:function $RelayQueryChecker_checkLinkedField(



field,state){
var dataID=state.dataID&&
this.$RelayQueryChecker_store.getLinkedRecordID(state.dataID,field.getStorageKey());
if(dataID===undefined){
state.result=false;
return;}

if(dataID){
var nextState={
dataID:dataID,
rangeInfo:undefined,
result:true};

this.traverse(field,nextState);
state.result=state.result&&nextState.result;}}}]);return RelayQueryChecker;}(require('RelayQueryVisitor'));




module.exports=require('RelayProfiler').instrument(
'checkRelayQueryData',
checkRelayQueryData);