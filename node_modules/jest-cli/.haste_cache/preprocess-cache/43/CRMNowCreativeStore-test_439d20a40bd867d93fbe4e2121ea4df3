'use strict';






jest.
dontMock('CRMNowCreativeStore').
dontMock('CRMNowEditorBaseStore').
dontMock('immutable');

jest.setMock('CRMLayout',{createFlow:{},largeListImage:{}});











var ADGROUP_ID='6033298897467';
var ADGROUP_NAME='TEST ADGROUP NAME';
var CREATIVE_ID='6033298897467';
var PROMOTED_OBJECT_ID='6033298897467';
var LEGACY_API_STORY_ID='747965511918993_944110862304456';
var TEXT='Hey test';
var NAME='Name';
var IMAGE_HASH='547699afb122f9ff25fe03df40e8c3d6';
var LINK='https://www.facebook.com/juice0001/';

describe('CRMNowCreativeStore',function(){

beforeEach(function(){
require('Relay').Store.read=jest.genMockFn();

require('CRMNowCreativeStore').onDispatchToken({
action:{
actionType:require('CRMNowActionTypes').BEGIN_EDITOR}});


require('CRMNowActionTypes').isEditorActionType.mockReturnValue(true);
require('CRMNowCapabilities').isPromotedObjectSupoorted.mockReturnValue(true);});


testInitialization();
testPopulateStoreWithPostEngagementStory();
testPopulateStoreWithLocalAwarenessStory();
testPopulateStoreWithWebsiteClickStory();
testPopulateStoreWithPageLikesStory();});


function testInitialization(){
it('initialized correctly',function(){
expect(require('CRMNowCreativeStore').shouldShowCTASection()).toBe(false);
expect(require('CRMNowCreativeStore').getCreativeCTA()).toBeNull();
expect(require('CRMNowCreativeStore').getSelectedPagePostID()).toBeNull();
expect(require('CRMNowCreativeStore').getSelectedPagePost()).toBeNull();
expect(require('CRMNowCreativeStore').getPresetPagePost()).toBeNull();
expect(require('CRMNowCreativeStore').getScheduledPosts().length).toBe(0);
expect(require('CRMNowCreativeStore').getText()).toBeNull();
expect(require('CRMNowCreativeStore').getSelectedURLType()).toBeNull();
expect(require('CRMNowCreativeStore').getURL()).toBeNull();
expect(require('CRMNowCreativeStore').getNewURL()).toBeNull();
expect(require('CRMNowCreativeStore').getHeadline()).toBeNull();
expect(require('CRMNowCreativeStore').getRawPhoneNumber()).toBeNull();
expect(require('CRMNowCreativeStore').getValidatedPhoneNumber()).toBeNull();
expect(require('CRMNowCreativeStore').getRawAddressString()).toBeNull();
expect(require('CRMNowCreativeStore').getValidatedAddress()).toBeNull();
expect(require('CRMNowCreativeStore').getImage()).toBeNull();
expect(require('CRMNowCreativeStore').getImageURI()).toBeNull();
expect(require('CRMNowCreativeStore').getImageTransformData()).toBeNull();
expect(require('CRMNowCreativeStore').getImageSourceCategory()).toBeNull();
expect(require('CRMNowCreativeStore').getImageHash()).toBeNull();});}



function testPopulateStoreWithPostEngagementStory(){
it('populated store with post engagement adgroup node',function(){
require('CRMNowObjectiveStore').getObjective.mockReturnValue(
require('CRMAPIObjectives').POST_ENGAGEMENT);


require('Relay').Store.read.mockReturnValue({
__dataID__:ADGROUP_ID,
id:ADGROUP_ID,
name:ADGROUP_NAME,
creative:getPostEngagementCreative()});


require('CRMNowObjectiveStore').getObjective.mockReturnValue(require('CRMAPIObjectives').POST_ENGAGEMENT);
var mockAdgroup={__dataID__:ADGROUP_ID};
require('CRMNowCreativeStore').handleEditorAction({
actionType:require('CRMNowActionTypes').EDITOR_ADGROUP_CHANGED,
adgroup:mockAdgroup});

expect(require('Relay').Store.read.mock.calls.length).toBe(1);
expect(require('Relay').Store.read.mock.calls[0][1]).toBe(ADGROUP_ID);

expect(require('CRMNowCreativeStore').shouldShowCTASection()).toBe(false);
expect(require('CRMNowCreativeStore').getCreativeCTA()).toBeNull();
expect(require('CRMNowCreativeStore').getSelectedPagePostID()).toBe(LEGACY_API_STORY_ID);
expect(require('CRMNowCreativeStore').getSelectedPagePost()).not.toBeNull();
expect(require('CRMNowCreativeStore').getPresetPagePost()).not.toBeNull();
expect(require('CRMNowCreativeStore').getScheduledPosts().length).toBe(0);
expect(require('CRMNowCreativeStore').getText()).toBe(TEXT);
expect(require('CRMNowCreativeStore').getSelectedURLType()).toBeNull();
expect(require('CRMNowCreativeStore').getURL()).toBeNull();
expect(require('CRMNowCreativeStore').getNewURL()).toBeNull();
expect(require('CRMNowCreativeStore').getHeadline()).toBeNull();
expect(require('CRMNowCreativeStore').getRawPhoneNumber()).toBeNull();
expect(require('CRMNowCreativeStore').getValidatedPhoneNumber()).toBeNull();
expect(require('CRMNowCreativeStore').getRawAddressString()).toBeNull();
expect(require('CRMNowCreativeStore').getValidatedAddress()).toBeNull();
expect(require('CRMNowCreativeStore').getImage()).toBeNull();
expect(require('CRMNowCreativeStore').getImageURI()).toBeNull();
expect(require('CRMNowCreativeStore').getImageTransformData()).toBeNull();
expect(require('CRMNowCreativeStore').getImageSourceCategory()).toBeNull();
expect(require('CRMNowCreativeStore').getImageHash()).toBeNull();});}



function testPopulateStoreWithLocalAwarenessStory(){
it('populated store with local awareness adgroup node',function(){
require('CRMNowObjectiveStore').getObjective.mockReturnValue(
require('CRMAPIObjectives').LOCAL_AWARENESS);


require('Relay').Store.read.mockReturnValue({
__dataID__:ADGROUP_ID,
id:ADGROUP_ID,
name:ADGROUP_NAME,
creative:getLocalAwarenessCreative()});


require('CRMNowObjectiveStore').getObjective.mockReturnValue(require('CRMAPIObjectives').LOCAL_AWARENESS);
var mockAdgroup={__dataID__:ADGROUP_ID};
require('CRMNowCreativeStore').onDispatchToken({
action:{
actionType:require('CRMNowActionTypes').EDITOR_ADGROUP_CHANGED,
adgroup:mockAdgroup}});


expect(require('Relay').Store.read.mock.calls.length).toBe(1);
expect(require('Relay').Store.read.mock.calls[0][1]).toBe(ADGROUP_ID);

expect(require('CRMNowCreativeStore').shouldShowCTASection()).toBe(true);
expect(require('CRMNowCreativeStore').getCreativeCTA()).toBe(require('CRMCallToActionTypes').TYPES.NO_BUTTON.name);
expect(require('CRMNowCreativeStore').getSelectedPagePostID()).toBeNull();
expect(require('CRMNowCreativeStore').getSelectedPagePost()).toBeNull();
expect(require('CRMNowCreativeStore').getPresetPagePost()).toBeNull();
expect(require('CRMNowCreativeStore').getScheduledPosts().length).toBe(0);
expect(require('CRMNowCreativeStore').getText()).toBe(TEXT);
expect(require('CRMNowCreativeStore').getSelectedURLType()).toBe(require('CRMNowURLType').NEW_URL);
expect(require('CRMNowCreativeStore').getURL()).toBe(LINK);
expect(require('CRMNowCreativeStore').getNewURL()).toBe(LINK);
expect(require('CRMNowCreativeStore').getHeadline()).toBe(NAME);
expect(require('CRMNowCreativeStore').getRawPhoneNumber()).toBeNull();
expect(require('CRMNowCreativeStore').getValidatedPhoneNumber()).toBeNull();
expect(require('CRMNowCreativeStore').getRawAddressString()).toBeNull();
expect(require('CRMNowCreativeStore').getValidatedAddress()).toBeNull();
expect(require('CRMNowCreativeStore').getImage()).toEqual(getCreativeImage());
expect(require('CRMNowCreativeStore').getImageURI()).toBeNull();
expect(require('CRMNowCreativeStore').getImageTransformData()).toBeNull();
expect(require('CRMNowCreativeStore').getImageSourceCategory()).toBeNull();
expect(require('CRMNowCreativeStore').getImageHash()).toBe(IMAGE_HASH);});}



function testPopulateStoreWithWebsiteClickStory(){
it('populated store with website click adgroup node',function(){
require('CRMNowObjectiveStore').getObjective.mockReturnValue(
require('CRMAPIObjectives').WEBSITE_CLICKS);


require('Relay').Store.read.mockReturnValue({
__dataID__:ADGROUP_ID,
id:ADGROUP_ID,
name:ADGROUP_NAME,
creative:getWebsiteClickCreative()});

require('CRMNowObjectiveStore').getObjective.mockReturnValue(require('CRMAPIObjectives').WEBSITE_CLICKS);
var mockAdgroup={__dataID__:ADGROUP_ID};
require('CRMNowCreativeStore').onDispatchToken({
action:{
actionType:require('CRMNowActionTypes').EDITOR_ADGROUP_CHANGED,
adgroup:mockAdgroup}});


expect(require('Relay').Store.read.mock.calls.length).toBe(1);
expect(require('Relay').Store.read.mock.calls[0][1]).toBe(ADGROUP_ID);

expect(require('CRMNowCreativeStore').shouldShowCTASection()).toBe(true);
expect(require('CRMNowCreativeStore').getCreativeCTA()).toBe(require('CRMCallToActionTypes').TYPES.SHOP_NOW.name);
expect(require('CRMNowCreativeStore').getSelectedPagePostID()).toBeNull();
expect(require('CRMNowCreativeStore').getSelectedPagePost()).toBeNull();
expect(require('CRMNowCreativeStore').getPresetPagePost()).toBeNull();
expect(require('CRMNowCreativeStore').getScheduledPosts().length).toBe(0);
expect(require('CRMNowCreativeStore').getText()).toBe(TEXT);
expect(require('CRMNowCreativeStore').getSelectedURLType()).toBe(require('CRMNowURLType').NEW_URL);
expect(require('CRMNowCreativeStore').getURL()).toBe(LINK);
expect(require('CRMNowCreativeStore').getNewURL()).toBe(LINK);
expect(require('CRMNowCreativeStore').getHeadline()).toBe(NAME);
expect(require('CRMNowCreativeStore').getRawPhoneNumber()).toBeNull();
expect(require('CRMNowCreativeStore').getValidatedPhoneNumber()).toBeNull();
expect(require('CRMNowCreativeStore').getRawAddressString()).toBeNull();
expect(require('CRMNowCreativeStore').getValidatedAddress()).toBeNull();
expect(require('CRMNowCreativeStore').getImage()).toEqual(getCreativeImage());
expect(require('CRMNowCreativeStore').getImageURI()).toBeNull();
expect(require('CRMNowCreativeStore').getImageTransformData()).toBeNull();
expect(require('CRMNowCreativeStore').getImageSourceCategory()).toBeNull();
expect(require('CRMNowCreativeStore').getImageHash()).toBe(IMAGE_HASH);});}



function testPopulateStoreWithPageLikesStory(){
it('populated store with page like adgroup node',function(){
require('CRMNowObjectiveStore').getObjective.mockReturnValue(
require('CRMAPIObjectives').PAGE_LIKES);


require('Relay').Store.read.mockReturnValue({
__dataID__:ADGROUP_ID,
id:ADGROUP_ID,
name:ADGROUP_NAME,
creative:getPageLikesCreative()});

require('CRMNowObjectiveStore').getObjective.mockReturnValue(require('CRMAPIObjectives').PAGE_LIKES);
var mockAdgroup={__dataID__:ADGROUP_ID};
require('CRMNowCreativeStore').onDispatchToken({
action:{
actionType:require('CRMNowActionTypes').EDITOR_ADGROUP_CHANGED,
adgroup:mockAdgroup}});


expect(require('Relay').Store.read.mock.calls.length).toBe(1);
expect(require('Relay').Store.read.mock.calls[0][1]).toBe(ADGROUP_ID);

expect(require('CRMNowCreativeStore').shouldShowCTASection()).toBe(false);
expect(require('CRMNowCreativeStore').getCreativeCTA()).toBeNull();
expect(require('CRMNowCreativeStore').getSelectedPagePostID()).toBeNull();
expect(require('CRMNowCreativeStore').getSelectedPagePost()).toBeNull();
expect(require('CRMNowCreativeStore').getPresetPagePost()).toBeNull();
expect(require('CRMNowCreativeStore').getScheduledPosts().length).toBe(0);
expect(require('CRMNowCreativeStore').getText()).toBe(TEXT);
expect(require('CRMNowCreativeStore').getSelectedURLType()).toBeNull();
expect(require('CRMNowCreativeStore').getURL()).toBeNull();
expect(require('CRMNowCreativeStore').getNewURL()).toBeNull();
expect(require('CRMNowCreativeStore').getHeadline()).toBeNull();
expect(require('CRMNowCreativeStore').getRawPhoneNumber()).toBeNull();
expect(require('CRMNowCreativeStore').getValidatedPhoneNumber()).toBeNull();
expect(require('CRMNowCreativeStore').getRawAddressString()).toBeNull();
expect(require('CRMNowCreativeStore').getValidatedAddress()).toBeNull();
expect(require('CRMNowCreativeStore').getImage()).toEqual(getCreativeImage());
expect(require('CRMNowCreativeStore').getImageURI()).toBeNull();
expect(require('CRMNowCreativeStore').getImageTransformData()).toBeNull();
expect(require('CRMNowCreativeStore').getImageSourceCategory()).toBeNull();
expect(require('CRMNowCreativeStore').getImageHash()).toBe(IMAGE_HASH);});}






function getPromotedObject(type){
return {
__dataID__:PROMOTED_OBJECT_ID,
node:{
__dataID__:'UzpfSTc0Nzk2NTUxMTkxODk5Mzo5NDQxMTA4NjIzMDQ0NTY=',
__type__:{
name:type},

attached_story:null,
attachments:[],
creation_time:1443829235,
legacy_api_story_id:LEGACY_API_STORY_ID,
message:{
__dataID__:'client:424688852861',
text:TEXT},

scheduled_publish_time:null,
title:null},

node_id:'944110862304456'};}



function getPostEngagementCreative(){
return {
__dataID__:CREATIVE_ID,
body_text:'',
creative_image:null,
image_hash:null,
object_story_spec:null,
promoted_object:getPromotedObject('Story')};}



function getLocalAwarenessCreative(){
return {
__dataID__:CREATIVE_ID,
body_text:'',
creative_image:getCreativeImage(),
image_hash:IMAGE_HASH,
object_story_spec:{
__dataID__:'client:105001775476',
link_data:getLinkData()},

promoted_object:getPromotedObject('Story')};}



function getWebsiteClickCreative(){
return {
__dataID__:CREATIVE_ID,
body_text:'',
creative_image:getCreativeImage(),
image_hash:IMAGE_HASH,
object_story_spec:{
__dataID__:'client:105001775476',
link_data:getWebsiteClickLinkData()},

promoted_object:getPromotedObject('Story')};}



function getPageLikesCreative(){
return {
__dataID__:CREATIVE_ID,
body_text:TEXT,
creative_image:getCreativeImage(),
image_hash:IMAGE_HASH,
object_story_spec:null,
promoted_object:getPromotedObject('Page')};}



function getCreativeImage(){
return {
__dataID__:'client:105001775478',
height:504,
uri:'https://www.facebook.com/ads/image/',
width:960};}



function getLinkData(){
return {
__dataID__:'client:105001775477',
call_to_action:null,
image_hash:IMAGE_HASH,
link:LINK,
message:TEXT,
name:NAME};}



function getWebsiteClickLinkData(){
return {
__dataID__:'client:105001775477',
call_to_action:{
__dataID__:'client:-14604825652677',
call_to_action_type:require('CRMCallToActionTypes').TYPES.SHOP_NOW.name,
call_to_action_value:{
__dataID__:'client:-14604825652678',
link:LINK}},


image_hash:IMAGE_HASH,
link:LINK,
message:TEXT,
name:NAME};}