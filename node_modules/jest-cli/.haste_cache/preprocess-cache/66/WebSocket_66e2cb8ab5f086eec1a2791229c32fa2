'use strict';













var RCTWebSocketModule=require('NativeModules').WebSocketModule;







var WebSocketId=0;
var CLOSE_NORMAL=1000;var 







WebSocket=function(_WebSocketBase){babelHelpers.inherits(WebSocket,_WebSocketBase);function WebSocket(){babelHelpers.classCallCheck(this,WebSocket);return babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(WebSocket).apply(this,arguments));}babelHelpers.createClass(WebSocket,[{key:'connectToSocketImpl',value:function connectToSocketImpl(



url,protocols,options){
this.$WebSocket_socketId=WebSocketId++;

RCTWebSocketModule.connect(url,protocols,options,this.$WebSocket_socketId);

this.$WebSocket_registerEvents(this.$WebSocket_socketId);}},{key:'closeConnectionImpl',value:function closeConnectionImpl(


code,reason){
this.$WebSocket_closeWebSocket(this.$WebSocket_socketId,code,reason);}},{key:'cancelConnectionImpl',value:function cancelConnectionImpl()


{
this.$WebSocket_closeWebSocket(this.$WebSocket_socketId);}},{key:'sendStringImpl',value:function sendStringImpl(


message){
RCTWebSocketModule.send(message,this.$WebSocket_socketId);}},{key:'sendArrayBufferImpl',value:function sendArrayBufferImpl()


{

console.warn('Sending ArrayBuffers is not yet supported');}},{key:'$WebSocket_closeWebSocket',value:function $WebSocket_closeWebSocket(


id,code,reason){
if(require('Platform').OS==='android'){



var statusCode=typeof code==='number'?code:CLOSE_NORMAL;
var closeReason=typeof reason==='string'?reason:'';
RCTWebSocketModule.close(statusCode,closeReason,id);}else 
{
RCTWebSocketModule.close(id);}}},{key:'$WebSocket_unregisterEvents',value:function $WebSocket_unregisterEvents()



{
this.$WebSocket_subs.forEach(function(e){return e.remove();});
this.$WebSocket_subs=[];}},{key:'$WebSocket_registerEvents',value:function $WebSocket_registerEvents(


id){var _this2=this;
this.$WebSocket_subs=[
require('RCTDeviceEventEmitter').addListener('websocketMessage',function(ev){
if(ev.id!==id){
return;}

var event=new (require('WebSocketEvent'))('message',{
data:ev.type==='binary'?require('base64-js').toByteArray(ev.data).buffer:ev.data});

_this2.onmessage&&_this2.onmessage(event);
_this2.dispatchEvent(event);}),

require('RCTDeviceEventEmitter').addListener('websocketOpen',function(ev){
if(ev.id!==id){
return;}

_this2.readyState=_this2.OPEN;
var event=new (require('WebSocketEvent'))('open');
_this2.onopen&&_this2.onopen(event);
_this2.dispatchEvent(event);}),

require('RCTDeviceEventEmitter').addListener('websocketClosed',function(ev){
if(ev.id!==id){
return;}

_this2.readyState=_this2.CLOSED;
var event=new (require('WebSocketEvent'))('close');
event.code=ev.code;
event.reason=ev.reason;
_this2.onclose&&_this2.onclose(event);
_this2.dispatchEvent(event);
_this2.$WebSocket_unregisterEvents();
_this2.close();}),

require('RCTDeviceEventEmitter').addListener('websocketFailed',function(ev){
if(ev.id!==id){
return;}

var event=new (require('WebSocketEvent'))('error');
event.message=ev.message;
_this2.onerror&&_this2.onerror(event);
_this2.onclose&&_this2.onclose(event);
_this2.dispatchEvent(event);
_this2.$WebSocket_unregisterEvents();
_this2.close();})];}}]);return WebSocket;}(require('WebSocketBase'));





module.exports=WebSocket;