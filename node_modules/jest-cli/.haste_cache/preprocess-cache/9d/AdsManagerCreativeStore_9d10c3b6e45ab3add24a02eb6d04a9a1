'use strict';

































var ImageSourceCategories=require('AdsManagerImageUtils').ImageSourceCategories;






var _marker={};var 
PagePost=function(){

function PagePost(storyNode,isScheduledPost){babelHelpers.classCallCheck(this,PagePost);
this.$PagePost_story=storyNode;
this.$PagePost_id=_marker;
this.$PagePost_title=_marker;
this.$PagePost_image=_marker;
this.$PagePost_isScheduledPost=isScheduledPost;}babelHelpers.createClass(PagePost,[{key:'getStoryID',value:function getStoryID()





{
if(this.$PagePost_id!==_marker){
return this.$PagePost_id;}












this.$PagePost_id=this.$PagePost_story.legacy_api_story_id?
this.$PagePost_story.legacy_api_story_id.split('_').slice(0,2).join('_'):null;

return this.$PagePost_id;}},{key:'getLegacyAPIStoryID',value:function getLegacyAPIStoryID()





{
return this.$PagePost_story.legacy_api_story_id;}},{key:'getTitle',value:function getTitle()


{
if(this.$PagePost_title!==_marker){
return this.$PagePost_title;}

var post=this.$PagePost_story;
var title='';
if(post.message){
title=post.message.text;}else 
if(post.title){
title=post.title.text;}



this.$PagePost_title=title.replace(/(\r\n|\n|\r)/gm,' ');
return this.$PagePost_title;}},{key:'getImage',value:function getImage()


{
if(this.$PagePost_image!==_marker){
return this.$PagePost_image;}


if(!this.$PagePost_story){
return null;}


var story=this.$PagePost_story;
var image=this.$PagePost_getImageFromAttachments(story);
if(image!==null){
this.$PagePost_image=image;
return this.$PagePost_image;}

if(story.attached_story===null){
this.$PagePost_image=null;
return this.$PagePost_image;}

this.$PagePost_image=this.$PagePost_getImageFromAttachments(story.attached_story);
return this.$PagePost_image;}},{key:'$PagePost_getImageFromAttachments',value:function $PagePost_getImageFromAttachments(


node){
if(!node.attachments||node.attachments.length===0){
return null;}


var attachment=node.attachments[0];
if(attachment&&attachment.media===null){
attachment=attachment.subattachments&&
attachment.subattachments.length&&
attachment.subattachments[0];}


return attachment&&
attachment.media&&
attachment.media.image;}},{key:'getLikesCount',value:function getLikesCount()


{
if(!this.$PagePost_story.feedback||!this.$PagePost_story.feedback.likers){
return 0;}

return this.$PagePost_story.feedback.likers.count;}},{key:'getCommentCount',value:function getCommentCount()


{
if(!this.$PagePost_story.feedback||!this.$PagePost_story.feedback.top_level_comments){
return 0;}

return this.$PagePost_story.feedback.top_level_comments.count;}},{key:'getCreationDate',value:function getCreationDate()


{
return new Date(this.$PagePost_story.creation_time*1000);}},{key:'getScheduledPublishDate',value:function getScheduledPublishDate()


{
return this.$PagePost_story.scheduled_publish_time?
new Date(this.$PagePost_story.scheduled_publish_time*1000):null;}},{key:'getIsScheduledPost',value:function getIsScheduledPost()


{
return this.$PagePost_isScheduledPost;}}]);return PagePost;}();



var Queries={

getAdgroupCreativeQuery:function(){
return function(RQL_0,RQL_1){return {children:[{children:[{children:[{fieldName:'raw_spec',kind:'Field',metadata:{},type:'String'},{children:[{fieldName:'name',kind:'Field',metadata:{},type:'String'},{fieldName:'message',kind:'Field',metadata:{},type:'String'},{fieldName:'link',kind:'Field',metadata:{},type:'String'},{fieldName:'image_hash',kind:'Field',metadata:{},type:'String'},{children:[{fieldName:'call_to_action_type',kind:'Field',metadata:{},type:'String'},{children:[{fieldName:'link',kind:'Field',metadata:{},type:'String'}],fieldName:'call_to_action_value',kind:'Field',metadata:{canHaveSubselections:true},type:'AdCallToActionValueSpecification'}],fieldName:'call_to_action',kind:'Field',metadata:{canHaveSubselections:true},type:'AdCallToActionSpecification'}],fieldName:'link_data',kind:'Field',metadata:{canHaveSubselections:true},type:'AdObjectStoryLinkDataSpecification'}],fieldName:'object_story_spec',kind:'Field',metadata:{canHaveSubselections:true},type:'AdObjectStorySpecification'},{children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'},{fieldName:'width',kind:'Field',metadata:{},type:'Int'},{fieldName:'height',kind:'Field',metadata:{},type:'Int'}],fieldName:'creative_image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{fieldName:'body_text',kind:'Field',metadata:{},type:'String'},{fieldName:'image_hash',kind:'Field',metadata:{},type:'String'},{children:[{fieldName:'node_id',kind:'Field',metadata:{},type:'ID'},{children:[].concat.apply([],[{children:[{fieldName:'name',kind:'Field',metadata:{},type:'String'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'},{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'}],id:require('Relay').QL.__id(),kind:'Fragment',metadata:{isAbstract:true},name:'IdFragment',type:'Node'}],fieldName:'__type__',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isAbstract:true},type:'Type'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'},require('Relay').QL.__frag(RQL_0),require('Relay').QL.__frag(RQL_1)]),fieldName:'node',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id',isAbstract:true},type:'Node'}],fieldName:'promoted_object',kind:'Field',metadata:{canHaveSubselections:true},type:'NodeWrapper'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'creative',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id'},type:'AdCreative'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],id:require('Relay').QL.__id(),kind:'Fragment',metadata:{},name:'AdsManagerCreativeStore_GetAdgroupCreativeQueryRelayQL',type:'Adgroup'};}(






























require('AdsManagerCreativePageQueries').getPageQuery(),
Queries.getStoryQuery());},







getStoryQuery:function(){
return function(RQL_0,RQL_1){return {children:[].concat.apply([],[{directives:[{kind:'Directive',name:'fixme_fat_interface',args:[]}],fieldName:'legacy_api_story_id',kind:'Field',metadata:{},type:'ID'},{children:[{fieldName:'text',kind:'Field',metadata:{},type:'String'}],fieldName:'message',kind:'Field',metadata:{canHaveSubselections:true},type:'TextWithEntities'},{children:[{fieldName:'text',kind:'Field',metadata:{},type:'String'}],fieldName:'title',kind:'Field',metadata:{canHaveSubselections:true},type:'TextWithEntities'},{children:[].concat.apply([],[{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},require('Relay').QL.__frag(RQL_1)]),fieldName:'attached_story',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id'},type:'Story'},{children:[{children:[{fieldName:'count',kind:'Field',metadata:{},type:'Int'}],fieldName:'likers',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true},type:'LikersOfContentConnection'},{children:[{fieldName:'count',kind:'Field',metadata:{},type:'Int'}],fieldName:'top_level_comments',kind:'Field',metadata:{canHaveSubselections:true,isConnection:true,isFindable:true},type:'TopLevelCommentsConnection'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'feedback',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id'},type:'Feedback'},{fieldName:'creation_time',kind:'Field',metadata:{},type:'Time'},{fieldName:'scheduled_publish_time',kind:'Field',metadata:{},type:'Time'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'},require('Relay').QL.__frag(RQL_0)]),id:require('Relay').QL.__id(),kind:'Fragment',metadata:{},name:'AdsManagerCreativeStore_GetStoryQueryRelayQL',type:'Story'};}(








Queries.getStoryAttachmentsQuery(),

Queries.getStoryAttachmentsQuery());},















getStoryAttachmentsQuery:function(){
return function(RQL_0,RQL_1){return {children:[{children:[].concat.apply([],[{children:[].concat.apply([],[require('Relay').QL.__frag(RQL_1)]),fieldName:'subattachments',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'StoryAttachment'},require('Relay').QL.__frag(RQL_0)]),fieldName:'attachments',kind:'Field',metadata:{canHaveSubselections:true,isPlural:true},type:'StoryAttachment'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],id:require('Relay').QL.__id(),kind:'Fragment',metadata:{},name:'AdsManagerCreativeStore_GetStoryAttachmentsQueryRelayQL',type:'Story'};}(


Queries.getStoryAttachmentsMediaQuery(),

Queries.getStoryAttachmentsMediaQuery());},






getStoryAttachmentsMediaQuery:function(){
return function(RQL_0,RQL_1){return {children:[{children:[{calls:[{kind:'Call',metadata:{},name:'size__width',value:require('Relay').QL.__var(RQL_0)},{kind:'Call',metadata:{},name:'size__height',value:require('Relay').QL.__var(RQL_1)},{kind:'Call',metadata:{},name:'sizing',value:{kind:'CallValue',callValue:'cover-fill'}}],children:[{fieldName:'uri',kind:'Field',metadata:{},type:'Url'}],directives:[{kind:'Directive',name:'fixme_call_args',args:[]}],fieldName:'image',kind:'Field',metadata:{canHaveSubselections:true},type:'Image'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'},{children:[{fieldName:'id',kind:'Field',metadata:{isRequisite:true},type:'ID'},{fieldName:'__typename',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'String'}],id:require('Relay').QL.__id(),kind:'Fragment',metadata:{isAbstract:true},name:'IdFragment',type:'Node'}],fieldName:'media',kind:'Field',metadata:{canHaveSubselections:true,isAbstract:true},type:'Media'}],id:require('Relay').QL.__id(),kind:'Fragment',metadata:{},name:'AdsManagerCreativeStore_GetStoryAttachmentsMediaQueryRelayQL',type:'StoryAttachment'};}(


require('AdsLayout').largeListImage.pixelSize,require('AdsLayout').largeListImage.pixelSize);},







getURLQuery:function(){
return function(){return {children:[{children:[{fieldName:'external_url',kind:'Field',metadata:{},type:'Url'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],fieldName:'global_share',kind:'Field',metadata:{canHaveSubselections:true,inferredRootCallName:'node',inferredPrimaryKey:'id'},type:'ExternalUrl'},{fieldName:'id',kind:'Field',metadata:{isGenerated:true,isRequisite:true},type:'ID'}],id:require('Relay').QL.__id(),kind:'Fragment',metadata:{},name:'AdsManagerCreativeStore_GetURLQueryRelayQL',type:'OpenGraphObject'};}();}};









var SPEC_FIELD_WILDCARD='*';

var _page;
var _postsByID;
var _scheduledPostsInOrder;
var _publishedPostsInOrder;
var _selectedPostID;
var _presetPostID;
var _text;
var _advertisedURL;
var _newURL;
var _selectedURLType;
var _headline;
var _rawPhoneNumber;

var _validatedPhoneNumber;
var _isScheduledPost;


var _image;

var _imageTransformData;

var _imageSourceCategory;
var _creativeCTA;
var _rawAddressString;

var _validatedAddress;
var _imageHash;
var _rawSpecForObjectStorySpec;

function _reset(){
_page=null;
_postsByID={};
_scheduledPostsInOrder=[];
_publishedPostsInOrder=[];
_selectedPostID=null;
_presetPostID=null;
_text=null;
_image=null;
_imageTransformData=null;
_imageSourceCategory=null;
_advertisedURL=null;
_newURL=null;
_selectedURLType=null;
_headline=null;
_rawPhoneNumber=null;
_validatedPhoneNumber=null;
_creativeCTA=null;
_isScheduledPost=false;
_rawAddressString=null;
_validatedAddress=null;
_imageHash=null;
_rawSpecForObjectStorySpec=null;}


function getPageDescription(page){
return page.about&&page.about.text;}var 


AdsManagerCreativeStore=function(_AdsManagerEditorBase){babelHelpers.inherits(AdsManagerCreativeStore,_AdsManagerEditorBase);

function AdsManagerCreativeStore(){babelHelpers.classCallCheck(this,AdsManagerCreativeStore);var _this=babelHelpers.possibleConstructorReturn(this,Object.getPrototypeOf(AdsManagerCreativeStore).call(this));

_this.Queries=Queries;return _this;}babelHelpers.createClass(AdsManagerCreativeStore,[{key:'beginEditor',value:function beginEditor()


{
_reset();

_page=require('AdsManagerPageStore').getPage();}},{key:'onDispatchToken',value:function onDispatchToken(


payload){
this.__dispatcher.waitFor([
require('AdsManagerCampaignGroupStore').getDispatchToken(),
require('AdsManagerMobileConfigStore').getDispatchToken(),
require('AdsManagerPageStore').getDispatchToken()]);

babelHelpers.get(Object.getPrototypeOf(AdsManagerCreativeStore.prototype),'onDispatchToken',this).call(this,payload);
switch(payload.action.actionType){
case require('AdsManagerActionTypes').BEGIN_EDITOR:
case require('AdsManagerActionTypes').RESET_EDITOR:

break;
default:

return;}

this.__emitChange();}},{key:'handleEditorAction',value:function handleEditorAction(


action){
var objective=require('AdsManagerCampaignGroupStore').getObjective();
switch(action.actionType){
case require('AdsManagerActionTypes').IMAGE_SELECT_VIEW_DID_FOCUS:
if(objective===require('AdsAPIObjectives').LOCAL_AWARENESS||
objective===require('AdsAPIObjectives').WEBSITE_CLICKS||
objective===require('AdsAPIObjectives').PAGE_LIKES){
if(!require('AdsManagerImageUtils').isValidImageSource(_image)&&
_page&&
_page.background_image)
{
_image=_page.background_image;
_imageTransformData=null;}}


break;
case require('AdsManagerActionTypes').OBJECTIVE_SELECTED:


_imageSourceCategory=this.$AdsManagerCreativeStore_getDefaultImageSourceCategory();


switch(objective){
case require('AdsAPIObjectives').POST_ENGAGEMENT:

_creativeCTA=null;
break;
case require('AdsAPIObjectives').WEBSITE_CLICKS:

_creativeCTA=require('AdsCallToActionTypes').TYPES.NO_BUTTON.name;
_headline=this.$AdsManagerCreativeStore_truncateText(
_page.name,
require('AdsManagerCreativeUtils').MAX_HEADLINE_LENGTH);

_text=this.$AdsManagerCreativeStore_truncateText(
getPageDescription(_page),
require('AdsManagerCreativeUtils').MAX_TEXT_LENGTH);

break;
case require('AdsAPIObjectives').PAGE_LIKES:

_creativeCTA=null;
_text=this.$AdsManagerCreativeStore_truncateText(
getPageDescription(_page),
require('AdsManagerCreativeUtils').MAX_TEXT_LENGTH);

break;
case require('AdsAPIObjectives').LOCAL_AWARENESS:
_text=this.$AdsManagerCreativeStore_truncateText(
getPageDescription(_page),
require('AdsManagerCreativeUtils').MAX_TEXT_LENGTH);







_selectedURLType=require('AdsManagerURLType').ADVERTISED_URL;
_advertisedURL=_page.url;
_headline=this.$AdsManagerCreativeStore_truncateText(
_page.name,
require('AdsManagerCreativeUtils').MAX_HEADLINE_LENGTH);

_validatedPhoneNumber=
require('AdsManagerCreativeUtils').getPhoneNumberFromPage(_page);
_rawPhoneNumber=_validatedPhoneNumber;


var locationURL=
require('AdsManagerCreativeUtils').getLocationURLFromPageLocation(_page);

_validatedAddress=
require('AdsManagerCreativeUtils').getValidatedAddressFromPageLocation(_page);
_rawAddressString=
_validatedAddress&&_validatedAddress.address_string;

_creativeCTA=locationURL?
require('AdsCallToActionTypes').TYPES.GET_DIRECTIONS.name:
require('AdsCallToActionTypes').TYPES.NO_BUTTON.name;
break;
default:
!false?require('invariant')(0,'unsupported creative objective'):undefined;}

break;
case require('AdsManagerActionTypes').PAGE_POST_SELECTED:
this.$AdsManagerCreativeStore_selectPagePost(action.postID);
break;
case require('AdsManagerActionTypes').PAGE_POST_PRESETED:
this.$AdsManagerCreativeStore_presetPagePostByID(action.postID);
break;
case require('AdsManagerActionTypes').CREATIVE_TEXT_CHANGED:
_text=action.text;
break;
case require('AdsManagerActionTypes').CREATIVE_URL_CHANGED:
_selectedURLType=action.urlType;
if(_selectedURLType===require('AdsManagerURLType').ADVERTISED_URL){
_advertisedURL=action.url;}else 
if(_selectedURLType===require('AdsManagerURLType').NEW_URL){
_newURL=action.url;}

break;
case require('AdsManagerActionTypes').CREATIVE_HEADLINE_CHANGED:
_headline=action.headline;
break;
case require('AdsManagerActionTypes').CREATIVE_RAW_PHONE_NUMBER_CHANGED:
_rawPhoneNumber=action.phoneNumber;
break;
case require('AdsManagerActionTypes').CREATIVE_VALIDATED_PHONE_NUMBER_CHANGED:
_validatedPhoneNumber=action.phoneNumber;
break;
case require('AdsManagerActionTypes').CREATIVE_RAW_ADDRESS_CHANGED:
_rawAddressString=action.address;
break;
case require('AdsManagerActionTypes').CREATIVE_VALIDATED_ADDRESS_CHANGED:
_validatedAddress=action.address;
break;
case require('AdsManagerActionTypes').IMAGE_SELECTED:
_image=action.image;
_imageTransformData=null;
break;
case require('AdsManagerActionTypes').IMAGE_TRANSFORM_DATA_CHANGED:
_imageTransformData=action.transformData;
break;
case require('AdsManagerActionTypes').IMAGE_SOURCE_CATEGORY_CHANGED:
_imageSourceCategory=action.imageSourceCategory;
break;
case require('AdsManagerActionTypes').CREATIVE_CTA_TYPE_SELECTED:
_creativeCTA=action.creativeCtaType;
break;
case require('AdsManagerActionTypes').RESUME_DRAFT:
this.$AdsManagerCreativeStore_resumeDraft(action.draft);
break;
case require('AdsManagerActionTypes').CREATIVE_DATA_SAVED:
var data=action.data;
_text=data.text;
_advertisedURL=data.advertisedURL;
_newURL=data.newURL;
_selectedURLType=data.urlType;
_headline=data.headline;
_creativeCTA=data.ctaType;
break;
case require('AdsManagerActionTypes').EDITOR_ADGROUP_CHANGED:
this.$AdsManagerCreativeStore_populateStoreWithAdgroup(action.adgroup);
break;
case require('AdsManagerActionTypes').CREATIVE_PAGE_POSTS_CHANGED:
this.$AdsManagerCreativeStore_setPagePosts(action.publishedStories,action.scheduledStories);
break;
case require('AdsManagerActionTypes').CREATIVE_PAGE_POST_STORY_CHANGED:
this.$AdsManagerCreativeStore_presetPagePostFromStory(action.story);
break;
case require('AdsManagerActionTypes').CREATIVE_ADVERTISED_URLS_CHANGED:
this.$AdsManagerCreativeStore_setPreselectedAdvertisedURL(action.urls);
break;
case require('AdsManagerActionTypes').SET_DEFAULT_IMAGE_IF_NEEDED:
if(
!require('AdsManagerImageUtils').isValidImageSource(_image)&&
_page&&
_page.background_image)
{
var scaledCropSize=
require('AdsManagerCreativeUtils').getScaledImageCropSizeForObjective(
require('AdsManagerCampaignGroupStore').getObjective());


_image=_page.background_image;







_imageTransformData=require('ImageTransformUtils').getDefaultTransformData(
scaledCropSize,
_image);}


break;
default:

return;}

this.__emitChange();}},{key:'resetEditor',value:function resetEditor()


{
_reset();}},{key:'$AdsManagerCreativeStore_populateStoreWithAdgroup',value:function $AdsManagerCreativeStore_populateStoreWithAdgroup(


adgroup){
var adgroup=require('Relay').Store.read(
require('fromGraphQL').Fragment(Queries.getAdgroupCreativeQuery()),
require('RelayRecord').getDataID(adgroup));


var creative=adgroup&&adgroup.creative;



!!!creative?require('invariant')(0,'invalid creative %s',creative):undefined;

var objective=require('AdsManagerCampaignGroupStore').getObjective();
var promotedObjectType=this.$AdsManagerCreativeStore_getPromotedObjectTypeFromCreative(creative);
!
require('AdsManagerCapabilities').isPromotedObjectSupoorted(
objective,
promotedObjectType)?require('invariant')(0,

'unsupported promoted object %s for objective %s',
promotedObjectType,
objective):undefined;


switch(objective){
case require('AdsAPIObjectives').POST_ENGAGEMENT:
this.$AdsManagerCreativeStore_presetPagePostFromStory(creative.promoted_object.node);
break;
case require('AdsAPIObjectives').WEBSITE_CLICKS:
case require('AdsAPIObjectives').LOCAL_AWARENESS:
!(
creative&&
creative.object_story_spec&&
creative.object_story_spec.link_data)?require('invariant')(0,
'invalid creative spec for objective %s',
objective):undefined;


_rawSpecForObjectStorySpec=creative.object_story_spec.raw_spec;

var link_data=creative.object_story_spec.link_data;
_text=link_data.message;
_newURL=link_data.link;
_selectedURLType=require('AdsManagerURLType').NEW_URL;
_headline=link_data.name;
_imageHash=link_data.image_hash;

if(this.$AdsManagerCreativeStore_canMutateCTA()){
var callToAction=link_data.call_to_action;
if(callToAction){
_creativeCTA=callToAction.call_to_action_type;}else 
{


_creativeCTA=require('AdsCallToActionTypes').TYPES.NO_BUTTON.name;}}



_image=creative.creative_image;

break;
case require('AdsAPIObjectives').PAGE_LIKES:









_page=creative.promoted_object.node;
_text=creative.body_text;
_imageHash=creative.image_hash;
_creativeCTA=null;

_image=creative.creative_image;
break;
default:

!false?require('invariant')(0,'unsupported creative objective %s',objective):undefined;}}},{key:'shouldShowCTASection',value:function shouldShowCTASection()



{
var objective=require('AdsManagerCampaignGroupStore').getObjective();
return objective===require('AdsAPIObjectives').WEBSITE_CLICKS||
objective===require('AdsAPIObjectives').LOCAL_AWARENESS;}},{key:'getCreativeCTA',value:function getCreativeCTA()


{
return _creativeCTA;}},{key:'$AdsManagerCreativeStore_getCTASpec',value:function $AdsManagerCreativeStore_getCTASpec()


{
if(!this.$AdsManagerCreativeStore_canMutateCTA()){
return null;}


var callToAction=null;

if(_creativeCTA===require('AdsCallToActionTypes').TYPES.NO_BUTTON.name||
_creativeCTA===require('AdsCallToActionTypes').TYPES.LIKE_PAGE.name){
return null;}

var uri=null;
var objective=require('AdsManagerCampaignGroupStore').getObjective();
switch(objective){
case require('AdsAPIObjectives').WEBSITE_CLICKS:
uri=this.getURL();
break;
case require('AdsAPIObjectives').LOCAL_AWARENESS:
switch(_creativeCTA){
case require('AdsCallToActionTypes').TYPES.CALL_NOW.name:
uri=require('AdsManagerCreativeUtils').getPhoneNumberURL(_validatedPhoneNumber);
break;
case require('AdsCallToActionTypes').TYPES.MESSAGE_PAGE.name:
uri=this.getURL();
break;
case require('AdsCallToActionTypes').TYPES.GET_DIRECTIONS.name:
uri=require('AdsManagerCreativeUtils').getLocationURLFromAddress(_validatedAddress);}

break;
default:
!false?require('invariant')(0,'this creative objective doesnt support CTA'):undefined;}

callToAction={
type:this.getCreativeCTA(),
value:{
link:uri}};


return callToAction;}},{key:'getSelectedPagePostID',value:function getSelectedPagePostID()


{
return _selectedPostID;}},{key:'$AdsManagerCreativeStore_selectPagePost',value:function $AdsManagerCreativeStore_selectPagePost(


postID){
var post=_postsByID[postID];
!post?require('invariant')(0,'Invalid post ID: '+postID):undefined;
var startTime=post.getScheduledPublishDate();
if(post.getIsScheduledPost()&&startTime){
var endTime=require('AdsManagerBudgetScheduleUtils').getDefaultEndTime(startTime);
require('AdsManagerActions').scheduleChanged(startTime,endTime);}

_selectedPostID=postID;
_text=post.getTitle();
_image=post.getImage();
_isScheduledPost=post.getIsScheduledPost();}},{key:'getSelectedPagePost',value:function getSelectedPagePost()


{
if(_selectedPostID===null){
return null;}

return _postsByID[_selectedPostID];}},{key:'getPresetPagePost',value:function getPresetPagePost()


{
return _postsByID[_presetPostID]||null;}},{key:'$AdsManagerCreativeStore_presetPagePostFromStory',value:function $AdsManagerCreativeStore_presetPagePostFromStory(


story){
var post=new PagePost(story);
_presetPostID=post.getStoryID();
if(!_presetPostID){
return;}


_postsByID[_presetPostID]=post;
this.$AdsManagerCreativeStore_selectPagePost(_presetPostID);}},{key:'$AdsManagerCreativeStore_presetPagePostByID',value:function $AdsManagerCreativeStore_presetPagePostByID(


pagePostID){
if(!pagePostID||!_postsByID[pagePostID]){
return;}


_presetPostID=pagePostID;
this.$AdsManagerCreativeStore_selectPagePost(_presetPostID);}},{key:'getScheduledPosts',value:function getScheduledPosts()


{
return _scheduledPostsInOrder.slice();}},{key:'getPublishedPosts',value:function getPublishedPosts()


{
return _publishedPostsInOrder.slice();}},{key:'$AdsManagerCreativeStore_setPagePosts',value:function $AdsManagerCreativeStore_setPagePosts(


publishedStoryEdge,scheduledStoryEdge){




this.$AdsManagerCreativeStore_setPublishedPosts(publishedStoryEdge);
this.$AdsManagerCreativeStore_setScheduledPosts(scheduledStoryEdge);}},{key:'$AdsManagerCreativeStore_setScheduledPosts',value:function $AdsManagerCreativeStore_setScheduledPosts(


storyEdges){
_scheduledPostsInOrder=[];
storyEdges.forEach(function(edge){



if(!edge.node.legacy_api_story_id||
!edge.node.scheduled_publish_time){
return;}

var post=new PagePost(edge.node,true);
_scheduledPostsInOrder.push(post);
_postsByID[post.getStoryID()]=post;});


if(_selectedPostID===null&&_scheduledPostsInOrder.length){
this.$AdsManagerCreativeStore_selectPagePost(_scheduledPostsInOrder[0].getStoryID());}}},{key:'$AdsManagerCreativeStore_setPublishedPosts',value:function $AdsManagerCreativeStore_setPublishedPosts(



storyEdges){
_publishedPostsInOrder=[];
storyEdges.forEach(function(edge){


if(!edge.node.legacy_api_story_id){
return;}

var post=new PagePost(edge.node,false);
_publishedPostsInOrder.push(post);
_postsByID[post.getStoryID()]=post;});


if(_selectedPostID===null&&_publishedPostsInOrder.length){
this.$AdsManagerCreativeStore_selectPagePost(_publishedPostsInOrder[0].getStoryID());}}},{key:'getText',value:function getText()



{
return _text;}},{key:'getAdvertisedURL',value:function getAdvertisedURL()


{
return _advertisedURL;}},{key:'$AdsManagerCreativeStore_setPreselectedAdvertisedURL',value:function $AdsManagerCreativeStore_setPreselectedAdvertisedURL(


urls){
if(urls&&urls.edges&&
urls.edges.length>0&&
require('AdsManagerCampaignGroupStore').getObjective()===
require('AdsAPIObjectives').WEBSITE_CLICKS&&
this.getSelectedURLType()===null){
this.$AdsManagerCreativeStore_setAdvertisedURLFromNode(urls.edges[0].node);}}},{key:'getNewURL',value:function getNewURL()



{
return _newURL;}},{key:'getURL',value:function getURL()


{
if(_selectedURLType===require('AdsManagerURLType').ADVERTISED_URL){
return this.getAdvertisedURL();}

return this.getNewURL();}},{key:'getSelectedURLType',value:function getSelectedURLType()


{
return _selectedURLType;}},{key:'getHeadline',value:function getHeadline()


{
return _headline;}},{key:'getRawPhoneNumber',value:function getRawPhoneNumber()


{
return _rawPhoneNumber;}},{key:'getValidatedPhoneNumber',value:function getValidatedPhoneNumber()


{
return _validatedPhoneNumber;}},{key:'getRawAddressString',value:function getRawAddressString()


{
return _rawAddressString;}},{key:'getValidatedAddress',value:function getValidatedAddress()


{
return _validatedAddress;}},{key:'getImage',value:function getImage()


{
return _image;}},{key:'getImageURI',value:function getImageURI()


{
var objective=require('AdsManagerCampaignGroupStore').getObjective();
if(require('AdsManagerCreativeUtils').isImageRequiredForObjective(objective)){
!
require('AdsManagerImageUtils').isValidImageSource(_image)?require('invariant')(0,
'invalid image source: %s',
JSON.stringify(_image)):undefined;

return _image.uri;}

return null;}},{key:'getImageTransformData',value:function getImageTransformData()


{
return _imageTransformData;}},{key:'getImageSourceCategory',value:function getImageSourceCategory()


{
return _imageSourceCategory;}},{key:'getImageHash',value:function getImageHash()


{
return _imageHash;}},{key:'shouldPreviewSkipImageProcessing',value:function shouldPreviewSkipImageProcessing()


{
return require('AdsManagerCampaignGroupStore').getObjective()===
require('AdsAPIObjectives').POST_ENGAGEMENT;}},{key:'getCreativeSpecWithoutImageHash',value:function getCreativeSpecWithoutImageHash()


{
var pageID=_page.id;
var objective=require('AdsManagerCampaignGroupStore').getObjective();
switch(objective){
case require('AdsAPIObjectives').POST_ENGAGEMENT:
var post=this.getSelectedPagePost();
if(!post){





return null;}

return {
object_story_id:post.getLegacyAPIStoryID()};

case require('AdsAPIObjectives').WEBSITE_CLICKS:
case require('AdsAPIObjectives').LOCAL_AWARENESS:
var linkData={
message:this.getText(),
link:this.getURL(),
name:this.getHeadline(),



description:' '};

var callToAction=this.$AdsManagerCreativeStore_getCTASpec();
if(callToAction!==null){
linkData.call_to_action=callToAction;}


if(this.$AdsManagerCreativeStore_isForCreateSimilar()){
return {
object_story_spec:{
raw_spec:_rawSpecForObjectStorySpec,
fields_retained_from_raw_spec:[SPEC_FIELD_WILDCARD],
page_id:pageID,
link_data:babelHelpers.extends({},
linkData,{
fields_retained_from_raw_spec:[SPEC_FIELD_WILDCARD]})}};}else 



{
var objectStorySpec={
page_id:pageID,
link_data:linkData};

if(require('AdsManagerPageStore').getIsInstagramCreationEligible(objective)){
objectStorySpec.instagram_actor_id=
require('AdsManagerPageStore').getInstagramAccountID();}


return {
object_story_spec:objectStorySpec};}


case require('AdsAPIObjectives').PAGE_LIKES:
return {
object_id:pageID,
body:this.getText()};

default:
!false?require('invariant')(0,'unsupported creative objective'):undefined;}}},{key:'getCreativeErrors',value:function getCreativeErrors()



{
var creativeCTA=this.getCreativeCTA();
var creativeData={};
switch(creativeCTA){
case require('AdsCallToActionTypes').TYPES.CALL_NOW.name:
creativeData.phoneNumber=this.getValidatedPhoneNumber();
break;
case require('AdsCallToActionTypes').TYPES.GET_DIRECTIONS.name:
creativeData.address=_validatedAddress;
break;}


return require('AdsManagerCreativeUtils').getCreativeErrors(
require('AdsManagerCampaignGroupStore').getObjective(),
this.getHeadline(),
this.getText(),
this.getURL(),
this.getImage(),
creativeCTA,
creativeData);}},{key:'getPhoneNumberError',value:function getPhoneNumberError()



{
return require('AdsManagerCreativeUtils').getPhoneNumberError(
this.getValidatedPhoneNumber());}},{key:'getAddressError',value:function getAddressError()



{
return require('AdsManagerCreativeUtils').getAddressError(this.getValidatedAddress());}},{key:'getHeadlineTooLongError',value:function getHeadlineTooLongError()


{
return require('AdsManagerCreativeUtils').getHeadlineTooLongError(this.getHeadline());}},{key:'getTextEmptyError',value:function getTextEmptyError()


{
return require('AdsManagerCreativeUtils').getTextEmptyError(this.getText());}},{key:'getTextTooLongError',value:function getTextTooLongError()


{
return require('AdsManagerCreativeUtils').getTextTooLongError(this.getText());}},{key:'getTextPuncStreakError',value:function getTextPuncStreakError()


{
return require('AdsManagerCreativeUtils').getTextPuncStreakError(
require('AdsManagerCampaignGroupStore').getObjective(),
this.getText());}},{key:'getTextBadCharError',value:function getTextBadCharError()



{
return require('AdsManagerCreativeUtils').getTextBadCharError(
require('AdsManagerCampaignGroupStore').getObjective(),
this.getText());}},{key:'getURLError',value:function getURLError()



{
return require('AdsManagerCreativeUtils').getURLError(this.getURL());}},{key:'getURLEmptyError',value:function getURLEmptyError()


{
return require('AdsManagerCreativeUtils').getURLEmptyError(this.getURL());}},{key:'getURLInvalidError',value:function getURLInvalidError()


{
return require('AdsManagerCreativeUtils').getURLInvalidError(this.getURL());}},{key:'getAdImageError',value:function getAdImageError()


{
return require('AdsManagerCreativeUtils').getAdImageError(
_image,
require('AdsManagerCampaignGroupStore').getObjective());}},{key:'getIsScheduledPost',value:function getIsScheduledPost()



{
return _isScheduledPost;}},{key:'$AdsManagerCreativeStore_setAdvertisedURLFromNode',value:function $AdsManagerCreativeStore_setAdvertisedURLFromNode(


urlNode){
var url=require('Relay').Store.read(
require('fromGraphQL').Fragment(Queries.getURLQuery()),
require('RelayRecord').getDataID(urlNode));

if(url&&url.global_share){
_selectedURLType=require('AdsManagerURLType').ADVERTISED_URL;
_advertisedURL=url.global_share.external_url;}}},{key:'$AdsManagerCreativeStore_resumeDraft',value:function $AdsManagerCreativeStore_resumeDraft(



draft){
var objective=require('AdsManagerCampaignGroupStore').getObjective();
var creativeSpec=draft.getAdgroupSpec().creative;

switch(objective){
case require('AdsAPIObjectives').POST_ENGAGEMENT:

break;
case require('AdsAPIObjectives').WEBSITE_CLICKS:
case require('AdsAPIObjectives').LOCAL_AWARENESS:
var link_data=creativeSpec.object_story_spec.link_data;
_text=link_data.message;

_newURL=link_data.link;
_selectedURLType=require('AdsManagerURLType').NEW_URL;
_headline=link_data.name;

var ctaData=draft.getCTAData();
_rawPhoneNumber=ctaData.raw_phone_number;
_validatedPhoneNumber=ctaData.validated_phone_number;
_rawAddressString=ctaData.raw_address;
_validatedAddress=ctaData.validated_address;

if(link_data.call_to_action){
_creativeCTA=link_data.call_to_action.type;}else 
{


_creativeCTA=require('AdsCallToActionTypes').TYPES.NO_BUTTON.name;}


_image=draft.getImageSource();
_imageTransformData=draft.getImageTransformData();
_imageSourceCategory=this.$AdsManagerCreativeStore_getImageSourceCategoryFromDraft(draft);
_imageHash=draft.getImageHash();
break;
case require('AdsAPIObjectives').PAGE_LIKES:
_text=creativeSpec.body;
_creativeCTA=null;

_image=draft.getImageSource();
_imageTransformData=draft.getImageTransformData();
_imageSourceCategory=this.$AdsManagerCreativeStore_getImageSourceCategoryFromDraft(draft);
_imageHash=draft.getImageHash();
break;
default:
!false?require('invariant')(0,'unsupported creative objective '+objective):undefined;}}},{key:'$AdsManagerCreativeStore_getImageSourceCategoryFromDraft',value:function $AdsManagerCreativeStore_getImageSourceCategoryFromDraft(



draft){
var draftImageSourceCategory=draft.getImageSourceCategory();
var isImageLibraryEnabled=require('AdsManagerMobileConfigStore').getQEConfig(
require('AdsManagerQENames').IMAGE_LIBRARY).
isEnabledNoExposure();

if(!draftImageSourceCategory){
return this.$AdsManagerCreativeStore_getDefaultImageSourceCategory();}


if(draftImageSourceCategory===ImageSourceCategories.PAGE_POST&&
isImageLibraryEnabled){


return ImageSourceCategories.IMAGE_LIBRARY;}


if(draftImageSourceCategory===ImageSourceCategories.IMAGE_LIBRARY&&
!isImageLibraryEnabled){


return ImageSourceCategories.PAGE_POST;}


return draftImageSourceCategory;}},{key:'$AdsManagerCreativeStore_getDefaultImageSourceCategory',value:function $AdsManagerCreativeStore_getDefaultImageSourceCategory()


{
var isImageLibraryEnabled=require('AdsManagerMobileConfigStore').getQEConfig(
require('AdsManagerQENames').IMAGE_LIBRARY).
isEnabledNoExposure();
return isImageLibraryEnabled?
ImageSourceCategories.IMAGE_LIBRARY:
ImageSourceCategories.PAGE_POST;}},{key:'$AdsManagerCreativeStore_truncateText',value:function $AdsManagerCreativeStore_truncateText(


text,maxTextLength){
if(text&&text.length>maxTextLength){
return text.substring(0,maxTextLength-3)+'...';}

return text;}},{key:'$AdsManagerCreativeStore_getPromotedObjectTypeFromCreative',value:function $AdsManagerCreativeStore_getPromotedObjectTypeFromCreative(


creative){
return (
creative&&
creative.promoted_object&&
creative.promoted_object.node_id&&
creative.promoted_object.node&&
creative.promoted_object.node.__type__&&
creative.promoted_object.node.__type__.name);}},{key:'$AdsManagerCreativeStore_isForCreateSimilar',value:function $AdsManagerCreativeStore_isForCreateSimilar()



{
return !!_rawSpecForObjectStorySpec;}},{key:'$AdsManagerCreativeStore_canMutateCTA',value:function $AdsManagerCreativeStore_canMutateCTA()


{




var objective=require('AdsManagerCampaignGroupStore').getObjective();
if(
this.$AdsManagerCreativeStore_isForCreateSimilar()&&
objective!==require('AdsAPIObjectives').WEBSITE_CLICKS)
{
return false;}

return true;}}]);return AdsManagerCreativeStore;}(require('AdsManagerEditorBaseStore'));



module.exports=new AdsManagerCreativeStore();